import WebSocket from "ws";
//@ts-expect-error - no types available
import XMLHttpRequest from "xhr2";
import JSON5 from "json5";
import pako from "pako";
import { HttpsProxyAgent } from "https-proxy-agent";
import { Crypto } from "@peculiar/webcrypto";
import { performance } from "perf_hooks";
import datachannel from "node-datachannel/polyfill";

const crypto = new Crypto();

let {
  RTCPeerConnection,
  RTCIceCandidate,
  RTCSessionDescription
} = datachannel;

let promiseResolve: ((value: typeof HBInit) => void) | null = null;
//@ts-expect-error - todo: fix types
let proxyAgent: HttpsProxyAgent | undefined;
let debug = false;

 interface HaxballJSConfig {
  proxy?: string;
  debug?: boolean;
  webrtc?: {
    RTCPeerConnection: typeof globalThis.RTCPeerConnection;
    RTCIceCandidate: typeof globalThis.RTCIceCandidate;
    RTCSessionDescription: typeof globalThis.RTCSessionDescription;
  };
}

const HBInitPromise: Promise<typeof HBInit> = new Promise(resolve => {
  promiseResolve = resolve;
});

export default function HaxballJS(config?: HaxballJSConfig): Promise<typeof HBInit> {
  if (config?.webrtc) {
    //@ts-expect-error
    RTCPeerConnection = config.webrtc.RTCPeerConnection;
    //@ts-expect-error
    RTCIceCandidate = config.webrtc.RTCIceCandidate;
    //@ts-expect-error
    RTCSessionDescription = config.webrtc.RTCSessionDescription;
  }

  if (config?.debug !== undefined) {
    debug = config.debug;
  }

  if (config?.proxy) {
    proxyAgent = new HttpsProxyAgent(new URL(config.proxy));
  }

  return HBInitPromise;
};

const onHBLoaded = <T extends (...args: any[]) => any>(cb: T): T => {
  return cb;
};

/* Builded & Automated with Haxball.JS Nodeify Script */

//@ts-expect-error - for the basro's minified code
/* HaxBall Â© Mario Carbajal - All rights reserved. 3f23b1af */ 'use strict';(function(wa){function pb(){return q.Zb(this,"")}function ib(a,b){if(null==b)return null;null==b.yd&&(b.yd=wa.ye++);var c;null==a.oe?a.oe={}:c=a.oe[b.yd];null==c&&(c=b.bind(a),a.oe[b.yd]=c);return c}class K{constructor(){this.m=32;this.c=63;this.i=1;this.ka=0;this.X=new I(0,0)}G(a){let b=this.X;a.g(b.x);a.g(b.y);a.g(this.ka);a.g(this.i);a.w(this.c);a.w(this.m)}qa(a){let b=this.X;b.x=a.o();b.y=a.o();this.ka=a.o();this.i=a.o();this.c=a.I();this.m=a.I()}}class P{constructor(){this.zb=this.vb= this.Mb=this.Xa=0;this.Od=u.fa;this.Ab=this.$a=0;this.ia=new Oa;this.Na=0;this.ab=5;this.ea=null}fh(a){this.ha=a;this.ab=a.ab;this.Na=a.Na;this.ea=a.ea;this.ia.v=this.ea.v;this.ia.Y=this.ea.Y;this.ia.J=this.ea.J;this.ia.Ta=this.ea.Ta;a=0;let b=this.ea.A;for(;a<b.length;)this.ia.A.push(b[a++].uh());this.af()}$e(a){if(a.ja==u.na)a.N=null;else{a.Kb=0;var b=a.N;null==b&&(b=new xa,a.N=b,this.ia.A.push(b));var c=this.ea.Nb;b.T=0;b.M=c.M;b.L=c.L;b.ga=c.ga;b.i=c.i;b.c=39;b.m=a.ja.m|c.m;var d=a.ja==u.fa?this.ea.Qb: this.ea.Jb;0==d.length?(b.a.x=a.ja.Qe*this.ea.cc,b.a.y=0):(a=b.a,d=d[d.length-1],a.x=d.x,a.y=d.y);d=b.u;d.x=0;d.y=0;b=b.la;c=c.la;b.x=c.x;b.y=c.y}}Ca(a){if(0<this.Xa)120>this.Xa&&this.Xa--;else{var b=this.ha.Pg;null!=b&&b();b=this.ha.ba;for(var c=0;c<b.length;){var d=b[c];++c;if(null!=d.N){0==(d.Kb&16)&&(d.Db=!1);var e=this.ea.Nb;0<d.uc&&d.uc--;d.Wb<this.ha.Qd&&d.Wb++;if(d.Db&&0>=d.uc&&0<=d.Wb){for(var f=!1,g=0,h=this.ia.A;g<h.length;){var l=h[g];++g;if(0!=(l.m&64)&&l!=d.N){var p=l.a,t=d.N.a,x=p.x- t.x;p=p.y-t.y;t=Math.sqrt(x*x+p*p);if(4>t-l.M-d.N.M){f=x/t;x=p/t;p=e.Mc;var B=t=l.u;l=l.L;t.x=B.x+f*p*l;t.y=B.y+x*p*l;B=d.N;l=-e.Nc;t=p=B.u;B=B.L;p.x=t.x+f*l*B;p.y=t.y+x*l*B;f=!0}}}f&&(null!=this.ha.vf&&this.ha.vf(d),d.Db=!1,d.uc=this.ha.Xc,d.Wb-=this.ha.fc)}f=d.Kb;h=g=0;0!=(f&1)&&--h;0!=(f&2)&&++h;0!=(f&4)&&--g;0!=(f&8)&&++g;0!=g&&0!=h&&(f=Math.sqrt(g*g+h*h),g/=f,h/=f);f=d.N.u;l=d.Db?e.Oc:e.zc;f.x+=g*l;f.y+=h*l;d.N.ga=d.Db?e.Pc:e.ga}}c=0;d=this.ia.A;e=0;for(g=d.length;e<g;)f=e++,h=d[f],0!=(h.m&128)&& (P.Re[c]=f,f=P.jf[c],h=h.a,f.x=h.x,f.y=h.y,++c);this.ia.Ca(a);if(0==this.$a){for(a=0;a<b.length;)c=b[a],++a,null!=c.N&&(c.N.c=39|this.Od.jh);b=this.ia.A[0].u;0<b.x*b.x+b.y*b.y&&(this.$a=1)}else if(1==this.$a){this.Mb+=.016666666666666666;for(a=0;a<b.length;)d=b[a],++a,null!=d.N&&(d.N.c=39);d=u.na;b=this.ia.A;for(a=0;a<c&&(d=a++,d=this.ea.Bg(b[P.Re[d]].a,P.jf[d]),d==u.na););d!=u.na?(this.$a=2,this.Ab=150,this.Od=d,d==u.fa?this.vb++:this.zb++,null!=this.ha.Lf&&this.ha.Lf(d.Zc),null!=this.ha.yf&&this.ha.yf(d.P)): 0<this.Na&&this.Mb>=60*this.Na&&this.zb!=this.vb&&(null!=this.ha.ki&&this.ha.ki(),this.If())}else if(2==this.$a)this.Ab--,0>=this.Ab&&(0<this.ab&&(this.zb>=this.ab||this.vb>=this.ab)||0<this.Na&&this.Mb>=60*this.Na&&this.zb!=this.vb?this.If():(this.af(),null!=this.ha.wf&&this.ha.wf()));else if(3==this.$a&&(this.Ab--,0>=this.Ab&&(b=this.ha,null!=b.D))){b.D=null;a=0;for(c=b.ba;a<c.length;)d=c[a],++a,d.N=null,d.Fb=0;null!=b.ld&&b.ld(null)}}}If(){this.Ab=300;this.$a=3;null!=this.ha.Mf&&this.ha.Mf(this.zb> this.vb?u.fa:u.ta)}af(){let a=this.ha.ba;this.$a=0;for(var b=this.ea.A,c=this.ia.A,d=0,e=this.ea.dd?b.length:1;d<e;){var f=d++;b[f].Ze(c[f])}b=[0,0,0];for(c=0;c<a.length;)if(d=a[c],++c,this.$e(d),e=d.ja,e!=u.na){f=d.N.a;var g=this.ea,h=b[e.P],l=e==u.fa?g.Qb:g.Jb;0==l.length?(l=h+1>>1,0==(h&1)&&(l=-l),g=g.Ma*e.Qe,h=55*l):(h>=l.length&&(h=l.length-1),h=l[h],g=h.x,h=h.y);f.x=g;f.y=h;b[e.P]++;d.Fb=b[e.P]}}G(a){this.ia.G(a);a.w(this.Ab);a.w(this.$a);a.w(this.zb);a.w(this.vb);a.g(this.Mb);a.w(this.Xa); a.f(this.Od.P)}}class Pa{static sa(a,b){null!=a&&a(b)}}class Qa{constructor(){this.ea=null;this.Xc=2;this.fc=0;this.Qd=1;this.ab=this.Na=3;this.md=!1;this.D=null;this.ba=[];this.Yd="";this.ea=w.Hd()[0];this.sc=[null,new W,new W];this.sc[1].Qa.push(u.fa.T);this.sc[2].Qa.push(u.ta.T)}fi(a){if(null==this.D){this.D=new P;for(var b=0,c=this.ba;b<c.length;){let d=c[b];++b;d.N=null;d.Fb=0}this.D.fh(this);null!=this.Jf&&this.Jf(a)}}Hc(a,b,c){if(b.ja!=c){b.ja=c;Q.remove(this.ba,b);this.ba.push(b);if(null!= this.D){null!=b.N&&(Q.remove(this.D.ia.A,b.N),b.N=null);this.D.$e(b);let d=0,e=!1;for(;!e;){++d;e=!0;let f=0,g=this.ba;for(;f<g.length;){let h=g[f];++f;if(h!=b&&h.ja==b.ja&&h.Fb==d){e=!1;break}}}b.Fb=d}jb.sa(this.Hh,a,b,c)}}O(a){let b=0,c=this.ba;for(;b<c.length;){let d=c[b];++b;if(d.ma==a)return d}return null}Ca(a){null!=this.D&&this.D.Ca(a)}G(a){a.Da(this.Yd);a.f(this.md?1:0);a.w(this.ab);a.w(this.Na);a.ie(this.Qd);a.f(this.fc);a.f(this.Xc);this.ea.G(a);a.f(null!=this.D?1:0);null!=this.D&&this.D.G(a); a.f(this.ba.length);let b=0,c=this.ba;for(;b<c.length;)c[b++].S(a);this.sc[1].G(a);this.sc[2].G(a)}Ue(){let a=0;var b=A.aa();this.G(b);for(b=b.ni();4<=b.j.byteLength-b.a;)a^=b.I();return a}Rg(){let a=A.aa(4);a.w(this.Ue());return a.ge()}Fg(a){a=(new L(new DataView(a))).I();Pa.sa(this.Ki,this.Ue()!=a)}Gf(a){this.yf=a}za(a){if(0==a)return!0;a=this.O(a);return null!=a&&a.Cb?!0:!1}bi(a,b,c,d){this.Xc=0>b?0:255<b?255:b;this.fc=0>c?0:255<c?255:c;0>d?d=0:100<d&&(d=100);this.Qd=this.fc*d;Xa.sa(this.ih,a, this.Xc,this.fc,d)}}class Ya{constructor(){this.list=[]}Ei(a){let b=0,c=a.eb,d=a.fb,e=0,f=this.list;for(;e<f.length;){var g=f[e];++e;let h=g.eb;if(h>c)break;if(h==c){g=g.fb;if(g>d)break;g==d&&++d}++b}a.fb=d;this.list.splice(b,0,a)}}class kb{}class Za{constructor(a){this.hb=null;this.Rh=1E4;this.Lc=!0;a.Me();this.oa=a.oa;this.jb=a.jb;this.Sb=a.Sb;this.hb=a.hb;this.Nf=performance.now();let b=null,c=this;b=function(){var e=c.Rh-c.li();0>=e?c.cb():(clearTimeout(c.Of),e=setTimeout(b, e+1E3),c.Of=e)};b();this.oa.oniceconnectionstatechange=function(){let e=c.oa.iceConnectionState;"closed"!=e&&"failed"!=e||c.cb()};a=0;let d=this.jb;for(;a<d.length;){let e=d[a];++a;e.onmessage=function(f){c.Lc&&(c.Nf=performance.now(),null!=c.nf&&c.nf(f.data))};e.onclose=function(){c.cb()}}}li(){return performance.now()-this.Nf}ob(a,b){if(this.Lc){var c=this.jb[a];0!=a&&"open"!=c.readyState&&(c=this.jb[0]);if("open"==c.readyState){a=b.ge();try{c.send(a)}catch(d){c=r.Vb(d).Ib(),wa.console.log(c)}}}}cb(){clearTimeout(this.Of); this.Lc&&(this.Lc=!1,this.oa.close(),null!=this.mf&&this.mf())}}class $a{constructor(a,b){this.dg=0;this.version=1;this.vd=0;this.Hb=A.aa(1E3);this.xc=A.aa(16384);this.version=b;let c=this.vd=a.da;this.qe=a;a.Ba.G(this.xc);let d=this;a.yb=function(f){let g=a.da;d.xc.Ea(g-c);c=g;d.xc.Oa(f.B);m.ue(f,d.xc)};this.Hb.Oa(0);let e=this.vd;a.Ba.Gf(function(f){let g=a.da;d.Hb.Ea(g-e);d.Hb.f(f);d.dg++;e=g})}stop(){this.qe.yb=null;this.qe.Ba.Gf(null);this.Hb.j.setUint16(0,this.dg,this.Hb.ra);this.Hb.pb(this.xc.Bb()); let a=pako.deflateRaw(this.Hb.Bb()),b=A.aa(a.byteLength+32);b.je("HBR2");b.xa(this.version);b.xa(this.qe.da-this.vd);b.pb(a);return b.Bb()}}class ya{constructor(){}}class X{}class za{static kh(){if(null!=za.Vd)return za.Vd;za.Vd=new Promise(function(a,b){var c=grecaptcha;null!=c?a(c):(c=createElement("script"),c.src="https://www.google.com/recaptcha/api.js?onload=___recaptchaload&render=explicit",head.appendChild(c),___recaptchaload=function(){a(grecaptcha)}, c.onerror=function(){b(null)})});return za.Vd}}class lb{}class Ra{static sa(a,b,c){null!=a&&a(b,c)}}class R{static qb(a,b){return a.length<=b?a:Q.substr(a,0,b)}static zi(a){let b="",c=0,d=a.byteLength;for(;c<d;)b+=qb.Ci(a[c++]);return b}}class mb{constructor(a){this.current=0;this.yi=a}next(){return this.yi[this.current++]}}class Aa{constructor(){this.T=0;this.qc=1/0;this.La=this.Va=100;this.Ic=this.Jc=0}G(a){a.f(this.Ic);a.f(this.Jc);a.g(this.La);a.g(this.Va);a.g(this.qc);a.w(this.T)}qa(a){this.Ic= a.C();this.Jc=a.C();this.La=a.o();this.Va=a.o();this.qc=a.o();this.T=a.I()}Ca(a){var b=a[this.Ic];a=a[this.Jc];if(null!=b&&null!=a){var c=b.a,d=a.a,e=c.x-d.x;c=c.y-d.y;var f=Math.sqrt(e*e+c*c);if(!(0>=f)){e/=f;c/=f;d=b.L/(b.L+a.L);d!=d&&(d=.5);if(this.La>=this.Va){var g=this.La;var h=0}else if(f<=this.La)g=this.La,h=1;else if(f>=this.Va)g=this.Va,h=-1;else return;f=g-f;if(0==0*this.qc)d=this.qc*f*.5,e*=d,c*=d,h=d=b.u,b=b.L,d.x=h.x+e*b,d.y=h.y+c*b,d=b=a.u,a=a.L,b.x=d.x+-e*a,b.y=d.y+-c*a;else{g=f*d; var l=b.a,p=b.a;l.x=p.x+e*g*.5;l.y=p.y+c*g*.5;p=l=a.a;f-=g;l.x=p.x-e*f*.5;l.y=p.y-c*f*.5;f=b.u;g=a.u;f=e*(f.x-g.x)+c*(f.y-g.y);0>=f*h&&(d*=f,b=h=b.u,h.x=b.x-e*d,h.y=b.y-c*d,a=b=a.u,d=f-d,b.x=a.x+e*d,b.y=a.y+c*d)}}}}}class nb{constructor(a,b){this.x=a;this.y=b}}class Sa{constructor(a,b){this.Le=a;this.Pf=b;this.tb=a;this.Qc=performance.now()}Qf(){var a;null==a&&(a=1);this.Ca();return a<=this.tb?(this.tb-=a,!0):!1}Ca(){let a=performance.now(),b=Math.floor((a-this.Qc)/this.Pf);this.Qc+= b*this.Pf;this.tb+=b;this.tb>=this.Le&&(this.tb=this.Le,this.Qc=a)}}class C{constructor(){this.Kc=0;this.m=32;this.c=63;this.i=1;this.a=new I(0,0)}G(a){let b=this.a;a.g(b.x);a.g(b.y);a.g(this.i);a.w(this.c);a.w(this.m)}qa(a){let b=this.a;b.x=a.o();b.y=a.o();this.i=a.o();this.c=a.I();this.m=a.I()}}class Ba{constructor(){this.ja=u.na;this.N=null;this.Wb=this.uc=0;this.Db=!1;this.Kb=this.ma=0;this.pa="Player";this.Bi=this.$c=0;this.country=null;this.ne=!1;this.Eb=this.Vf=null;this.Fb=0;this.Cb=!1}S(a){a.f(this.Cb? 1:0);a.w(this.Fb);a.Da(this.Eb);a.Da(this.Vf);a.f(this.ne?1:0);a.Da(this.country);a.w(this.Bi);a.Da(this.pa);a.w(this.Kb);a.Ea(this.ma);a.f(this.Db?1:0);a.ie(this.Wb);a.f(this.uc);a.f(this.ja.P);a.ie(null==this.N?-1:this.N.rf)}}class I{constructor(a,b){this.x=a;this.y=b}}class jb{static sa(a,b,c,d){null!=a&&a(b,c,d)}}class W{constructor(){this.ee=16777215;this.Qa=[]}G(a){a.f(this.Je);a.w(this.ee);a.f(this.Qa.length);let b=0,c=this.Qa;for(;b<c.length;)a.w(c[b++])}qa(a){this.Je=a.C();this.ee=a.I(); let b=a.C();if(3<b)throw r.s("too many");this.Qa=[];let c=0;for(;c<b;)++c,this.Qa.push(a.I())}}class Ca{}class ka{static si(a,b){try{let c=new L(new DataView(a.buffer,a.byteOffset,a.byteLength),!1);c.C();let d=c.Ga(c.kc()),e=c.Ga(),f=new L(new DataView(d.buffer,d.byteOffset,d.byteLength),!1),g=f.mb(),h=f.mb(),l=f.Ga();if(l.byteLength!=b.byteLength)return Promise.reject(null);a=0;let p=l.byteLength;for(;a<p;){let t=a++;if(l[t]!=b[t])return Promise.reject(null)}return ka.vi(g,h).then(function(t){return crypto.subtle.verify(ka.di, t,e,d)}).then(function(t){if(!t)throw r.s(null);return g})}catch(c){return Promise.reject(r.Vb(c).Ib())}}static vi(a,b){try{return crypto.subtle.importKey("jwk",{crv:"P-256",ext:!0,key_ops:["verify"],kty:"EC",x:a,y:b},ka.tg,!0,["verify"])}catch(c){return Promise.reject(r.Vb(c).Ib())}}}class Ta{constructor(){this.Nc=0;this.M=15;this.m=0;this.la=new I(0,0);this.L=this.i=.5;this.ga=.96;this.zc=.1;this.Oc=.07;this.Pc=.96;this.Mc=5}G(a){a.g(this.i);a.g(this.L);a.g(this.ga);a.g(this.zc);a.g(this.Oc); a.g(this.Pc);a.g(this.Mc);let b=this.la;a.g(b.x);a.g(b.y);a.w(this.m);a.g(this.M);a.g(this.Nc)}qa(a){this.i=a.o();this.L=a.o();this.ga=a.o();this.zc=a.o();this.Oc=a.o();this.Pc=a.o();this.Mc=a.o();let b=this.la;b.x=a.o();b.y=a.o();this.m=a.I();this.M=a.o();this.Nc=a.o()}}class E{static th(){rb.Di();Y.Tg().then(function(a){E.Se=a},function(){}).then(function(){promiseResolve(E.gi);let a=onHBLoaded;null!=a&&a()});E.Wh=null}static ci(a,b,c){null== E.bd&&(E.bd=null,E.Qh=a.render(E.bd,{sitekey:b,callback:function(d){null!=E.Xd&&E.Xd(d)}}));E.bd.hidden=!1;a.reset(E.Qh);E.Xd=function(d){setTimeout(function(){E.bd.hidden=!0;c(d)},1E3);E.Xd=null}}static vh(a,b){return"https://www.haxball.com/play?c="+a+(b?"&p=1":"")}static gi(a){function b(){if(!l){var k=new ab;k.ri=9;k.pa=y.Yd;k.ba=y.ba.length-(x?0:1);k.yh=D.Wc;k.ib=Da.ib;k.lb=null!=D.lb;k.Rc=Da.Rc;k.Tc=Da.Tc;var n=A.aa(16);k.G(n);D.ce(n.ge())}}function c(k){ob.then(function(){D.nc(k)})} function d(k){return null==k?null:{x:k.a.x,y:k.a.y,xspeed:k.u.x,yspeed:k.u.y,xgravity:k.la.x,ygravity:k.la.y,radius:k.M,bCoeff:k.i,invMass:k.L,damping:k.ga,color:k.T,cMask:k.c,cGroup:k.m}}function e(){return null==y.D?null:{red:y.D.zb,blue:y.D.vb,time:y.D.Mb,scoreLimit:y.D.ab,timeLimit:60*y.D.Na}}function f(k){if(null==k)return null;let n=null,v=k.N;null!=v&&(n={x:v.a.x,y:v.a.y});return{name:k.pa,team:k.ja.P,id:k.ma,admin:k.Cb,position:n}}function g(k,n){k=a[k];return null==k?n:q.l(k,String)}function h(k, n){k=a[k];return null==k?n:k}if(E.Ff)throw r.s("Can't init twice");E.Ff=!0;let l=!h("public",!1);var p=g("roomName","Headless Room");let t=g("playerName","Host"),x=h("noPlayer",!1),B=q.l(h("maxPlayers",12),Ea),N=g("password",null),la=g("token",null),sb=h("geo",null),Da=E.Se;if(null!=sb&&(Da=Y.Te(sb),3<Da.ib.length))throw r.s("Invalid country code");let y=new Qa;y.Yd=p;x||(p=new Ba,p.pa=t,p.Cb=!0,p.country=Da.ib,y.ba.push(p));let D=new Ua({iceServers:Ca.Nd,Fi:Ca.Ke+"api/host",state:y,version:9,Ii:la}); D.Wc=2>B?2:30<B?30:B;D.lb=N;let ob=Promise.resolve();b();let bb=null,J={sendChat:function(k,n){let v=new ma;v.Pa=k;null!=n?ob.then(function(){D.Df(v,n)}):c(v)},sendAnnouncement:function(k,n,v,F,H){F={bold:1,italic:2,small:3,"small-bold":4,"small-italic":5}[F];null==F&&(F=0);null==v&&(v=-1);null==H&&(H=1);let aa=Z.V(k,v,F,H);null!=n?ob.then(function(){D.Df(aa,n)}):c(aa)},setPlayerAdmin:function(k,n){c(ba.V(k,n))},setPlayerTeam:function(k,n){c(ca.V(k,1==n?u.fa:2==n?u.ta:u.na))},setPlayerAvatar:function(k, n){c(da.V(k,n))},kickPlayer:function(k,n,v){null==n&&(n="");c(S.V(k,n,v))},clearBan:function(k){D.Ed(k)},clearBans:function(){D.Fd()},setScoreLimit:function(k){c(T.V(0,k))},setTimeLimit:function(k){c(T.V(1,k))},setCustomStadium:function(k){let n=new w;try{n.lh(k)}catch(v){throw r.s(r.Vb(v).Ib());}c(U.V(n))},setDefaultStadium:function(k){let n=w.Hd(),v=null,F=0;for(;F<n.length;){let H=n[F];++F;if(H.pa==k){v=H;break}}if(null==v)throw r.s("Stadium doesn't exist");c(U.V(v))},setDiscProperties:function(k, n){c(M.cg(k,!1,n))},setPlayerDiscProperties:function(k,n){c(M.cg(k,!0,n))},setTeamColors:function(k,n,v,F){let H=new na,aa=new W;H.rd=aa;H.ja=1==k?u.fa:2==k?u.ta:u.na;aa.Qa=[];var cb=F.length;k=0;for(cb=3>cb?cb:3;k<cb;)aa.Qa.push(F[k++]|0);aa.ee=v|0;aa.Je=256*n/360|0;c(H)},setKickRateLimit:function(k,n,v){null==k&&(k=2);null==n&&(n=0);null==v&&(v=0);k=ea.V(k,n,v);c(k)},startGame:function(){c(new oa)},stopGame:function(){c(new pa)},pauseGame:function(k){let n=new qa;n.wc=k;c(n)},setTeamsLock:function(k){let n= new ra;n.newValue=k;c(n)},setPassword:function(k){D.lb=null==k?null:q.l(k,String);b()},setRequireRecaptcha:function(k){D.be(q.l(k,db))},getPlayerList:function(){let k=[],n=0,v=y.ba;for(;n<v.length;)k.push(f(v[n++]));return k},getPlayer:function(k){k=y.O(k);return null==k?null:f(k)},getScores:function(){return e()},getBallPosition:function(){var k=y.D;if(null==k)return null;k=k.ia.A[0].a;return{x:k.x,y:k.y}},getPlayerDiscProperties:function(k){if(null==y.D)return null;k=y.O(k);return null==k?null: d(k.N)},getDiscProperties:function(k){let n=y.D;return null==n?null:d(n.ia.A[k])},getDiscCount:function(){let k=y.D;return null==k?0:k.ia.A.length},startRecording:function(){bb=new $a(D,3)},stopRecording:function(){if(null==bb)return null;let k=bb.stop();bb=null;return k},reorderPlayers:function(k,n){c(fa.V(k,n))},CollisionFlags:{ball:1,red:2,blue:4,redKO:8,blueKO:16,wall:32,kick:64,score:128,c0:268435456,c1:536870912,c2:1073741824,c3:-2147483648,all:63}};D.ic=function(k,n){za.kh().then(function(v){E.ci(v, k,n)})};setInterval(function(){D.Ca()},50);setInterval(function(){D.nc(ha.V(D))},3E3);D.kf=function(k){null!=y.O(k)&&D.nc(S.V(k,"Bad actor",!1))};D.zh=function(k,n){let v=n.mb();if(25<v.length)throw r.s("name too long");let F=n.mb();if(3<F.length)throw r.s("country too long");n=n.Ya();if(null!=n&&2<n.length)throw r.s("avatar too long");D.nc(ia.V(k,v,F,n));b()};D.Ah=function(k){null!=y.O(k)&&D.nc(S.V(k,null,!1))};D.Yc=function(k){k=E.vh(k,null!=D.lb);E.Wh='<p>Room Link: <a href="'+ k+'">'+k+"</a></p>";{let n=J.onRoomLink;null!=n&&n(k)}};y.Fh=function(k){var n=D.wb.get(k.ma),v=null,F=null;null!=n&&(v=n.Jg,F=n.jc.hb);n=v;v=J.onPlayerJoin;null!=v&&(k=f(k),k.auth=n,k.conn=F,v(k))};y.Mf=function(){{let k=J.onTeamVictory;null!=k&&null!=y.D&&k(e())}};y.tf=function(k,n){let v=J.onPlayerChat;return null==v?!0:0!=v(f(k),n)};y.vf=function(k){let n=J.onPlayerBallKick;null!=n&&n(f(k))};y.Lf=function(k){let n=J.onTeamGoal;null!=n&&null!=y.D&&n(k.P)};y.Jf=function(k){let n=J.onGameStart;null!= n&&n(f(k))};y.ld=function(k){let n=J.onGameStop;null!=n&&n(f(k))};y.Hh=function(k,n){let v=J.onPlayerTeamChange;null!=v&&v(f(n),f(k))};y.sf=function(k,n){let v=J.onPlayerAdminChange;null!=v&&v(f(n),f(k))};y.Pg=function(){let k=J.onGameTick;null!=k&&k()};y.Dh=function(k,n){n=J[n?"onGamePause":"onGameUnpause"];null!=n&&n(f(k))};y.wf=function(){let k=J.onPositionsReset;null!=k&&k()};y.uf=function(k){{let n=J.onPlayerActivity;null!=n&&n(f(k))}};y.Hf=function(k,n){let v=J.onStadiumChange;null!=v&&v(n.pa, f(k))};y.Gh=function(k,n,v,F){b();var H=J.onPlayerLeave;null!=H&&H(f(k));null!=n&&(H=null,null!=F&&(H=F.pa),D.Ng(k.ma,n,H,v),H=J.onPlayerKicked,null!=H&&H(f(k),n,v,f(F)))};y.ih=function(k,n,v,F){let H=J.onKickRateLimitSet;null!=H&&H(n,v,F,f(k))};y.ji=function(k,n){let v=J.onTeamsLockChange;null!=v&&v(n,f(k))};return J}}class eb{constructor(a){let b=[],c=0;for(;c<a;)++c,b.push(0);this.gd=b;this.tc=this.hc=0}rg(a){this.tc-=this.gd[this.hc];this.gd[this.hc]=a;this.tc+=a;this.hc++;this.hc>=this.gd.length&& (this.hc=0)}vg(){return this.tc/this.gd.length}}class Va{}class A{constructor(a,b){null==b&&(b=!1);this.j=a;this.ra=b;this.a=0}ge(){let a=new ArrayBuffer(this.a),b=new Uint8Array(this.j.buffer,this.j.byteOffset,this.a);(new Uint8Array(a)).set(b);return a}Bb(){return new Uint8Array(this.j.buffer,this.j.byteOffset,this.a)}Tb(){return new DataView(this.j.buffer,this.j.byteOffset,this.a)}ni(){return new L(this.Tb(),this.ra)}Ja(a){this.j.byteLength<a&&this.Sh(2*this.j.byteLength>=a?2*this.j.byteLength: a)}Sh(a){if(1>a)throw r.s("Can't resize buffer to a capacity lower than 1");if(this.j.byteLength<a){let b=new Uint8Array(this.j.buffer);a=new ArrayBuffer(a);(new Uint8Array(a)).set(b);this.j=new DataView(a)}}f(a){let b=this.a++;this.Ja(this.a);this.j.setUint8(b,a)}ie(a){let b=this.a;this.a+=2;this.Ja(this.a);this.j.setInt16(b,a,this.ra)}Oa(a){let b=this.a;this.a+=2;this.Ja(this.a);this.j.setUint16(b,a,this.ra)}w(a){let b=this.a;this.a+=4;this.Ja(this.a);this.j.setInt32(b,a,this.ra)}xa(a){let b=this.a; this.a+=4;this.Ja(this.a);this.j.setUint32(b,a,this.ra)}he(a){let b=this.a;this.a+=4;this.Ja(this.a);this.j.setFloat32(b,a,this.ra)}g(a){let b=this.a;this.a+=8;this.Ja(this.a);this.j.setFloat64(b,a,this.ra)}pb(a){let b=this.a;this.a+=a.byteLength;this.Ja(this.a);(new Uint8Array(this.j.buffer,this.j.byteOffset,this.j.byteLength)).set(a,b)}ui(a){a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);this.pb(a)}Sf(a){this.pb(new Uint8Array(a))}Ub(a){this.Ea(A.Bd(a));this.je(a)}Da(a){null==a?this.Ea(0): (this.Ea(A.Bd(a)+1),this.je(a))}Uf(a){a=(new TextEncoder).encode(a);let b=a.length;if(255<b)throw r.s(null);this.f(b);this.ui(a)}Tf(a){this.Ub(JSON.stringify(a))}je(a){let b=this.a;this.Ja(b+A.Bd(a));let c=a.length,d=0;for(;d<c;)b+=A.Og(Q.Xf(a,d++),this.j,b);this.a=b}Ea(a){let b=this.a;a>>>=0;this.Ja(b+A.yg(a));this.j.setUint8(b,a|128);128<=a?(this.j.setUint8(b+1,a>>7|128),16384<=a?(this.j.setUint8(b+2,a>>14|128),2097152<=a?(this.j.setUint8(b+3,a>>21|128),268435456<=a?(this.j.setUint8(b+4,a>>28&127), a=5):(this.j.setUint8(b+3,this.j.getUint8(b+3)&127),a=4)):(this.j.setUint8(b+2,this.j.getUint8(b+2)&127),a=3)):(this.j.setUint8(b+1,this.j.getUint8(b+1)&127),a=2)):(this.j.setUint8(b,this.j.getUint8(b)&127),a=1);this.a+=a}static aa(a,b){null==b&&(b=!1);null==a&&(a=16);return new A(new DataView(new ArrayBuffer(a)),b)}static Og(a,b,c){let d=c;if(0>a)throw r.s("Cannot encode UTF8 character: charCode ("+a+") is negative");if(128>a)b.setUint8(c,a&127),++c;else if(2048>a)b.setUint8(c,a>>6&31|192),b.setUint8(c+ 1,a&63|128),c+=2;else if(65536>a)b.setUint8(c,a>>12&15|224),b.setUint8(c+1,a>>6&63|128),b.setUint8(c+2,a&63|128),c+=3;else if(2097152>a)b.setUint8(c,a>>18&7|240),b.setUint8(c+1,a>>12&63|128),b.setUint8(c+2,a>>6&63|128),b.setUint8(c+3,a&63|128),c+=4;else if(67108864>a)b.setUint8(c,a>>24&3|248),b.setUint8(c+1,a>>18&63|128),b.setUint8(c+2,a>>12&63|128),b.setUint8(c+3,a>>6&63|128),b.setUint8(c+4,a&63|128),c+=5;else if(-2147483648>a)b.setUint8(c,a>>30&1|252),b.setUint8(c+1,a>>24&63|128),b.setUint8(c+2, a>>18&63|128),b.setUint8(c+3,a>>12&63|128),b.setUint8(c+4,a>>6&63|128),b.setUint8(c+5,a&63|128),c+=6;else throw r.s("Cannot encode UTF8 character: charCode ("+a+") is too large (>= 0x80000000)");return c-d}static xg(a){if(0>a)throw r.s("Cannot calculate length of UTF8 character: charCode ("+a+") is negative");if(128>a)return 1;if(2048>a)return 2;if(65536>a)return 3;if(2097152>a)return 4;if(67108864>a)return 5;if(-2147483648>a)return 6;throw r.s("Cannot calculate length of UTF8 character: charCode ("+ a+") is too large (>= 0x80000000)");}static Bd(a){let b=0,c=a.length,d=0;for(;d<c;)b+=A.xg(Q.Xf(a,d++));return b}static yg(a){a>>>=0;return 128>a?1:16384>a?2:2097152>a?3:268435456>a?4:5}}class Oa{constructor(){this.A=[]}G(a){a.f(this.A.length);let b=0,c=this.A.length;for(;b<c;){let d=b++,e=this.A[d];e.rf=d;e.G(a)}}Ca(a){for(var b=0,c=this.A;b<c.length;){var d=c[b];++b;var e=d.a,f=d.a,g=d.u;e.x=f.x+g.x*a;e.y=f.y+g.y*a;f=e=d.u;g=d.la;d=d.ga;e.x=(f.x+g.x)*d;e.y=(f.y+g.y)*d}a=0;for(b=this.A.length;a< b;){d=a++;c=this.A[d];d+=1;for(e=this.A.length;d<e;)f=this.A[d++],0!=(f.c&c.m)&&0!=(f.m&c.c)&&c.Dg(f);if(0!=c.L){d=0;for(e=this.Y;d<e.length;)if(f=e[d],++d,0!=(f.c&c.m)&&0!=(f.m&c.c)){g=f.X;var h=c.a;g=f.ka-(g.x*h.x+g.y*h.y)+c.M;if(0<g){var l=h=c.a,p=f.X;h.x=l.x+p.x*g;h.y=l.y+p.y*g;g=c.u;h=f.X;g=g.x*h.x+g.y*h.y;0>g&&(g*=c.i*f.i+1,l=h=c.u,f=f.X,h.x=l.x-f.x*g,h.y=l.y-f.y*g)}}d=0;for(e=this.J;d<e.length;)f=e[d],++d,0!=(f.c&c.m)&&0!=(f.m&c.c)&&c.Eg(f);d=0;for(e=this.v;d<e.length;)if(f=e[d],++d,0!=(f.c& c.m)&&0!=(f.m&c.c)&&(h=c.a,l=f.a,g=h.x-l.x,h=h.y-l.y,l=g*g+h*h,0<l&&l<=c.M*c.M)){l=Math.sqrt(l);g/=l;h/=l;l=c.M-l;let t=p=c.a;p.x=t.x+g*l;p.y=t.y+h*l;l=c.u;l=g*l.x+h*l.y;0>l&&(l*=c.i*f.i+1,p=f=c.u,f.x=p.x-g*l,f.y=p.y-h*l)}}}for(a=0;2>a;)for(++a,b=0,c=this.Ta;b<c.length;)c[b++].Ca(this.A)}}class L{constructor(a,b){null==b&&(b=!1);this.j=a;this.ra=b;this.a=0}Ga(a){null==a&&(a=this.j.byteLength-this.a);if(this.a+a>this.j.byteLength)throw r.s("Read too much");let b=new Uint8Array(this.j.buffer,this.j.byteOffset+ this.a,a);this.a+=a;return b}Oh(a){let b=this.Ga(a);a=new ArrayBuffer(a);(new Uint8Array(a)).set(b);return a}Wd(){return this.j.getInt8(this.a++)}C(){return this.j.getUint8(this.a++)}kc(){let a=this.j.getUint16(this.a,this.ra);this.a+=2;return a}I(){let a=this.j.getInt32(this.a,this.ra);this.a+=4;return a}Pb(){let a=this.j.getUint32(this.a,this.ra);this.a+=4;return a}Ph(){let a=this.j.getFloat32(this.a,this.ra);this.a+=4;return a}o(){let a=this.j.getFloat64(this.a,this.ra);this.a+=8;return a}nb(){let a= this.a,b=0,c,d=0;do c=this.j.getUint8(a+b),5>b&&(d|=(c&127)<<7*b>>>0),++b;while(0!=(c&128));this.a+=b;return d|0}ad(a){let b=this.a,c,d="";for(a=b+a;b<a;)c=L.Kg(this.j,b),b+=c.length,d+=String.fromCodePoint(c.char);if(b!=a)throw r.s("Actual string length differs from the specified: "+(b-a)+" bytes");this.a=b;return d}Ya(){let a=this.nb();return 0>=a?null:this.ad(a-1)}mb(){return this.ad(this.nb())}xf(){let a=this.mb();return JSON.parse(a)}static Kg(a,b){var c=a.getUint8(b);let d,e,f,g,h=b;if(0==(c& 128))++b;else if(192==(c&224))d=a.getUint8(b+1),c=(c&31)<<6|d&63,b+=2;else if(224==(c&240))d=a.getUint8(b+1),e=a.getUint8(b+2),c=(c&15)<<12|(d&63)<<6|e&63,b+=3;else if(240==(c&248))d=a.getUint8(b+1),e=a.getUint8(b+2),f=a.getUint8(b+3),c=(c&7)<<18|(d&63)<<12|(e&63)<<6|f&63,b+=4;else if(248==(c&252))d=a.getUint8(b+1),e=a.getUint8(b+2),f=a.getUint8(b+3),g=a.getUint8(b+4),c=(c&3)<<24|(d&63)<<18|(e&63)<<12|(f&63)<<6|g&63,b+=5;else if(252==(c&254))d=a.getUint8(b+1),e=a.getUint8(b+2),f=a.getUint8(b+3),g= a.getUint8(b+4),a=a.getUint8(b+5),c=(c&1)<<30|(d&63)<<24|(e&63)<<18|(f&63)<<12|(g&63)<<6|a&63,b+=6;else throw r.s("Cannot decode UTF8 character at offset "+b+": charCode ("+c+") is invalid");return{char:c,length:b-h}}}class tb{static Ai(a){let b=[];if(null!=a){let d=Object.prototype.hasOwnProperty;for(var c in a)"__id__"!=c&&"hx__closures__"!=c&&d.call(a,c)&&b.push(c)}return b}}class Fa{constructor(){this.rc=u.na;this.K=new I(0,0);this.F=new I(0,0)}G(a){var b=this.F;a.g(b.x);a.g(b.y);b=this.K;a.g(b.x); a.g(b.y);a.f(this.rc.P)}qa(a){var b=this.F;b.x=a.o();b.y=a.o();b=this.K;b.x=a.o();b.y=a.o();a=a.Wd();this.rc=1==a?u.fa:2==a?u.ta:u.na}}class V{static zf(a,b,c,d){return new Promise(function(e,f){let g=new XMLHttpRequest;g.open(b,a);g.responseType="json";g.onload=function(){200<=g.status&&300>g.status?null!=g.response?e(g.response):f(null):f("status: "+g.status)};g.onerror=function(h){f(h)};null!=d&&g.setRequestHeader("Content-type",d);g.send(c)})}static Qg(a){return V.zf(a,"GET",null)}static Sg(a){return V.Qg(a).then(function(b){let c= b.error;if(null!=c)throw r.s(c);return b.data})}static Ih(a,b,c){return V.zf(a,"POST",b,c)}static Jh(a,b,c){return V.Ih(a,b,c).then(function(d){let e=d.error;if(null!=e)throw r.s(e);return d.data})}}class sa{constructor(a,b,c){this.hb=this.fe=null;this.Sb=[];this.Pe=0;this.pf=!1;this.Md=[];this.jb=[];this.oa=new RTCPeerConnection({iceServers:b},sa.Gg);let d;this.Ye=new Promise(function(f){d=f});let e=this;this.oa.onicecandidate=function(f){null==f.candidate?d(e.Md):(f=f.candidate,null!=f.candidate&& ""!=f.candidate&&(null!=e.Ud&&e.Ud(f),e.Md.push(f)))};for(b=0;b<c.length;)this.Ig(c[b++]);this.P=a}hi(){var a;null==a&&(a=1E4);clearTimeout(this.fe);this.fe=setTimeout(ib(this,this.eh),a)}async Hg(a,b){await this.oa.setRemoteDescription(a);a=await this.oa.createAnswer();await this.oa.setLocalDescription(a);let c=0;for(;c<b.length;)this.Ie(b[c++]);try{await ub.mi(this.Ye)}catch(d){}return a}Ig(a){let b=this.jb.length,c={id:b,negotiated:!0,ordered:a.ordered};a.reliable||(c.maxRetransmits= 0);a=this.oa.createDataChannel(a.name,c);a.binaryType="arraybuffer";let d=this;0==b&&(a.onopen=function(){null!=d.Sd&&d.Sd()});a.onclose=function(){d.Jd()};a.onmessage=function(){d.Jd()};this.jb.push(a)}Ie(a){let b=this;setTimeout(function(){"closed"!=b.oa.iceConnectionState&&b.oa.addIceCandidate(a).catch(function(){})},this.Pe)}eh(){this.Jd()}Jd(){null!=this.Td&&this.Td();this.cb()}cb(){this.Me();this.oa.close()}Me(){clearTimeout(this.fe);this.Sd=this.Ud=this.Td=null;this.oa.onicecandidate= null;this.oa.ondatachannel=null;this.oa.onsignalingstatechange=null;this.oa.oniceconnectionstatechange=null;let a=0,b=this.jb;for(;a<b.length;){let c=b[a];++a;c.onopen=null;c.onclose=null;c.onmessage=null}}}class ja{constructor(){this.c=this.m=63;this.T=16777215;this.ga=.99;this.L=1;this.i=.5;this.M=10;this.la=new I(0,0);this.u=new I(0,0);this.a=new I(0,0)}G(a){var b=this.a;a.g(b.x);a.g(b.y);b=this.u;a.g(b.x);a.g(b.y);b=this.la;a.g(b.x);a.g(b.y);a.g(this.M);a.g(this.i);a.g(this.L);a.g(this.ga);a.xa(this.T); a.w(this.c);a.w(this.m)}qa(a){var b=this.a;b.x=a.o();b.y=a.o();b=this.u;b.x=a.o();b.y=a.o();b=this.la;b.x=a.o();b.y=a.o();this.M=a.o();this.i=a.o();this.L=a.o();this.ga=a.o();this.T=a.Pb();this.c=a.I();this.m=a.I()}uh(){let a=new xa;this.Ze(a);return a}Ze(a){var b=a.a,c=this.a;b.x=c.x;b.y=c.y;b=a.u;c=this.u;b.x=c.x;b.y=c.y;b=a.la;c=this.la;b.x=c.x;b.y=c.y;a.M=this.M;a.i=this.i;a.L=this.L;a.ga=this.ga;a.T=this.T;a.c=this.c;a.m=this.m}}class Wa{static xe(a){return q.Zb(a,"")}static parseInt(a){a=parseInt(a); return isNaN(a)?null:a}}class vb{static Ch(a){a=a.split(" ");let b=a[4];if("typ"!=a[6])throw r.s(null);return{oi:a[7],gh:b}}}class u{constructor(a,b,c,d,e,f,g,h){this.Zc=null;this.P=a;this.T=b;this.Qe=c;this.jh=d;this.pa=e;this.m=h;this.ii=new W;this.ii.Qa.push(b)}}class q{static Zf(a){if(null==a)return null;if(a instanceof Array)return Array;{let b=a.h;if(null!=b)return b;a=q.Ee(a);return null!=a?q.pg(a):null}}static Zb(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"== c&&(a.b||a.Ce)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a.Yb){var d=fb[a.Yb].Be[a.Ld];c=d.Xe;if(d.Ge){b+="\t";var e=[],f=0;for(d=d.Ge;f<d.length;){let g=d[f];f+=1;e.push(q.Zb(a[g],b))}a=e;return c+"("+a.join(",")+")"}return c}if(a instanceof Array){c="[";b+="\t";e=0;for(f=a.length;e<f;)d=e++,c+=(0<d?",":"")+q.Zb(a[d],b);return c+="]"}try{e=a.toString}catch(g){return"???"}if(null!=e&&e!=Object.toString&&"function"==typeof e&&(c=a.toString(),"[object Object]"!=c))return c; c="{\n";b+="\t";e=null!=a.hasOwnProperty;f=null;for(f in a)e&&!a.hasOwnProperty(f)||"prototype"==f||"__class__"==f||"__super__"==f||"__interfaces__"==f||"__properties__"==f||(2!=c.length&&(c+=", \n"),c+=b+f+" : "+q.Zb(a[f],b));b=b.substring(1);return c+="\n"+b+"}";case "string":return a;default:return String(a)}}static De(a,b){for(;;){if(null==a)return!1;if(a==b)return!0;let c=a.gb;if(null!=c&&(null==a.H||a.H.gb!=c)){let d=0,e=c.length;for(;d<e;){let f=c[d++];if(f==b||q.De(f,b))return!0}}a=a.H}}static ng(a, b){if(null==b)return!1;switch(b){case Array:return a instanceof Array;case db:return"boolean"==typeof a;case xb:return null!=a;case z:return"number"==typeof a;case Ea:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(q.mg(a,b))return!0}else{if("object"==typeof b&&q.og(b)&&a instanceof b)return!0}else return!1;return b==yb&&null!=a.b||b==zb&&null!=a.Ce?!0:null!=a.Yb?fb[a.Yb]==b:!1}}static mg(a,b){return a instanceof b?!0:b.zd? q.De(q.Zf(a),b):!1}static l(a,b){if(null==a||q.ng(a,b))return a;throw r.s("Cannot cast "+Wa.xe(a)+" to "+Wa.xe(b));}static Ee(a){a=q.qg.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a}static og(a){return null!=q.Ee(a)}static pg(a){return wa[a]}}class Ga{constructor(a,b,c,d){this.Ac=new Set;this.$b=new Set;this.ed=this.lc=this.Ef=!1;this.Za=null;this.mc=this.P="";this.Uh=5E4;this.Th=1E4;this.xb=new Map;this.ei=a;this.Nd=b;this.Ag=c;this.mc=d;null==this.mc&&(this.mc= "");this.de()}ce(a){if(null!=this.Za||null!=a){if(null!=this.Za&&null!=a&&this.Za.byteLength==a.byteLength){let c=new Uint8Array(this.Za),d=new Uint8Array(a),e=!1,f=0,g=this.Za.byteLength;for(;f<g;){let h=f++;if(c[h]!=d[h]){e=!0;break}}if(!e)return}this.Za=a.slice(0);this.ed=!0;var b=this;null!=this.ua&&1==this.ua.readyState&&null==this.fd&&(this.$d(),this.fd=setTimeout(function(){b.fd=null;1==b.ua.readyState&&b.ed&&b.$d()},1E4))}}be(a){function b(){null!=c.ua&&1==c.ua.readyState&&c.lc!=c.Ef&& c.Cf();c.Af=null}this.lc=a;let c=this;null==this.Af&&(b(),this.Af=setTimeout(b,1E3))}de(a){function b(e){e=e.sitekey;if(null==e)throw r.s(null);null!=d.ic&&d.ic(e,function(f){d.de(f)})}function c(e){let f=e.url;if(null==f)throw r.s(null);e=e.token;if(null==e)throw r.s(null);d.ua=new WebSocket(f+"?token="+e, {headers:{origin: "https://html5.haxball.com"}, agent: proxyAgent});d.ua.binaryType="arraybuffer";d.ua.onopen=function(){d.dh()};d.ua.onclose=function(g){d.Id(4001!=g.code)};d.ua.onerror=function(err){d.Id(!0);debug && console.error(err)};;d.ua.onmessage=ib(d,d.bh)}null==a&&(a="");let d= this;V.Jh(this.ei,"token="+this.mc+"&rcr="+a,V.ig).then(function(e){switch(e.action){case "connect":c(e);break;case "recaptcha":console.log(new Error("Invalid Token Provided!"))}}).catch(function(){d.Id(!0)})}dh(){null!=this.Za&&this.$d();0!=this.lc&&this.Cf();let a=this;this.Eh=setInterval(function(){a.Zh()},4E4)}bh(a){a=new L(new DataView(a.data),!1);switch(a.C()){case 1:this.$g(a);break;case 4:this.Vg(a);break;case 5:this.Xg(a);break;case 6:this.Zg(a)}}$g(a){let b=a.Pb(),c=R.zi(a.Ga(a.C())),d,e,f;try{var g=ta.Wf(a.Ga(),wb);a=new L(new DataView(g.buffer, g.byteOffset,g.byteLength),!1);d=0!=a.C();e=a.mb();let h=a.xf();g=[];let l=0;for(;l<h.length;)g.push(new RTCIceCandidate(h[l++]));f=g}catch(h){this.oc(b,0);return}this.ah(b,c,e,f,a,d)}ah(a,b,c,d,e,f){if(16<=this.xb.size)this.oc(a,4104);else if(this.Ac.has(b))this.oc(a,4102);else{for(var g=[],h=0;h<d.length;){let x=Ga.Ve(d[h++]);if(null!=x){if(this.$b.has(x)){this.oc(a,4102);return}g.push(x)}}if(null!=this.Ne&&(h=new L(e.j),h.a=e.a,e=this.Ne(b,h),1==e.Ld)){this.oc(a,e.reason);return}var l=new sa(a, this.Nd,this.Ag);f&&(l.Pe=2500);l.Sb=g;l.hb=b;this.xb.set(a,l);var p=this,t=function(){p.pc(0,l,null);p.xb.delete(l.P)};l.Td=t;l.Sd=function(){p.xb.delete(l.P);p.pc(0,l,null);null!=p.lf&&p.lf(new Za(l))};l.hi();(async function(){try{let x=await l.Hg(new RTCSessionDescription({sdp:c,type:"offer"}),d);p.$h(l,x,l.Md);l.Ye.then(function(){p.pc(0,l,null)});l.Ud=function(B){p.Yh(l,B)}}catch(x){t()}})()}}Vg(a){let b=a.Pb(),c;try{let d=ta.Wf(a.Ga(),wb);a=new L(new DataView(d.buffer,d.byteOffset,d.byteLength), !1);c=new RTCIceCandidate(a.xf())}catch(d){return}this.Wg(b,c)}Wg(a,b){a=this.xb.get(a);if(null!=a){let c=Ga.Ve(b);if(null!=c&&(a.Sb.push(c),this.$b.has(c)))return;a.Ie(b)}}Xg(a){this.P=a.ad(a.C());null!=this.Yc&&this.Yc(this.P)}Zg(a){this.mc=a.ad(a.j.byteLength-a.a)}pc(a,b,c){if(!b.pf){0==a&&(b.pf=!0);var d=b.P;b=A.aa(32,!1);b.f(a);b.xa(d);null!=c&&(a=pako.deflateRaw(c.Bb()),b.pb(a));this.ua.send(b.Tb())}}oc(a,b){let c=A.aa(16,!1);c.f(0);c.xa(a);c.Oa(b);this.ua.send(c.Tb())}Zh(){let a=A.aa(1,!1); a.f(8);this.ua.send(a.Tb())}$d(){this.ed=!1;let a=A.aa(256,!1);a.f(7);null!=this.Za&&a.Sf(this.Za);this.ua.send(a.Tb())}Cf(){let a=A.aa(2,!1);a.f(9);a.f(this.lc?1:0);this.ua.send(a.Tb());this.Ef=this.lc}$h(a,b,c){let d=A.aa(32,!1);d.Ub(b.sdp);d.Tf(c);this.pc(1,a,d)}Yh(a,b){let c=A.aa(32,!1);c.Tf(b);this.pc(4,a,c)}Mg(){let a=this.xb.values(),b=a.next();for(;!b.done;){let c=b.value;b=a.next();c.cb()}this.xb.clear()}Id(a){this.Mg();clearTimeout(this.fd);this.fd=null;this.ed=!1;clearInterval(this.Eh); clearTimeout(this.Vh);let b=this;a&&(this.Vh=setTimeout(function(){b.de()},this.Th+Math.random()*this.Uh|0))}wg(a){let b=0,c=a.Sb;for(;b<c.length;)this.$b.add(c[b++]);null!=a.hb&&this.Ac.add(a.hb);return{Hi:a.Sb,xi:a.hb}}Fd(){this.$b.clear();this.Ac.clear()}Ed(a){let b=0,c=a.Hi;for(;b<c.length;)this.$b.delete(c[b++]);this.Ac.delete(a.xi)}static Ve(a){try{let b=vb.Ch(a.candidate);if("srflx"==b.oi)return b.gh}catch(b){}return null}}class Y{constructor(){this.ib="";this.Rc=this.Tc=0}static Te(a){let b= new Y;b.Rc=a.lat;b.Tc=a.lon;b.ib=a.code.toLowerCase();return b}static Tg(){return V.Sg(Ca.Ke+"api/geo").then(function(a){return Y.Te(a)})}}class Xa{static sa(a,b,c,d,e){null!=a&&a(b,c,d,e)}}class w{constructor(){this.v=[];this.J=[];this.Y=[];this.Sa=[];this.A=[];this.Ta=[];this.Qb=[];this.Jb=[];this.Nb=new Ta;this.Gd=255;this.Cd=this.Rd=0;this.Dd=!0;this.dd=!1}Uc(){let a=new ja;a.T=16777215;a.c=63;a.m=193;a.M=10;a.ga=.99;a.L=1;a.i=.5;return a}G(a){a.f(this.Gd);if(!this.hh()){a.Da(this.pa);a.w(this.Ec); a.g(this.Fc);a.g(this.Dc);a.g(this.bc);a.g(this.ac);a.g(this.Ad);a.w(this.Cc);a.g(this.cc);a.g(this.Gc);a.g(this.Ma);this.Nb.G(a);a.Oa(this.Rd);a.f(this.Cd);a.f(this.Dd?1:0);a.f(this.dd?1:0);a.f(this.v.length);for(var b=0,c=this.v.length;b<c;){var d=b++;let e=this.v[d];e.Kc=d;e.G(a)}a.f(this.J.length);b=0;for(c=this.J;b<c.length;)c[b++].G(a);a.f(this.Y.length);b=0;for(c=this.Y;b<c.length;)c[b++].G(a);a.f(this.Sa.length);b=0;for(c=this.Sa;b<c.length;)c[b++].G(a);a.f(this.A.length);b=0;for(c=this.A;b< c.length;)c[b++].G(a);a.f(this.Ta.length);b=0;for(c=this.Ta;b<c.length;)c[b++].G(a);a.f(this.Qb.length);b=0;for(c=this.Qb;b<c.length;)d=c[b],++b,a.g(d.x),a.g(d.y);a.f(this.Jb.length);b=0;for(c=this.Jb;b<c.length;)d=c[b],++b,a.g(d.x),a.g(d.y)}}pi(a){function b(){let f=[],g=a.C(),h=0;for(;h<g;){++h;let l=new I(0,0);l.x=a.o();l.y=a.o();f.push(l)}return f}this.pa=a.Ya();this.Ec=a.I();this.Fc=a.o();this.Dc=a.o();this.bc=a.o();this.ac=a.o();this.Ad=a.o();this.Cc=a.I();this.cc=a.o();this.Gc=a.o();this.Ma= a.o();this.Nb.qa(a);this.Rd=a.kc();this.Cd=a.C();this.Dd=0!=a.C();this.dd=0!=a.C();this.v=[];for(var c=a.C(),d=0;d<c;){var e=new C;e.qa(a);e.Kc=d++;this.v.push(e)}this.J=[];c=a.C();for(d=0;d<c;)++d,e=new G,e.qa(a,this.v),this.J.push(e);this.Y=[];c=a.C();for(d=0;d<c;)++d,e=new K,e.qa(a),this.Y.push(e);this.Sa=[];c=a.C();for(d=0;d<c;)++d,e=new Fa,e.qa(a),this.Sa.push(e);this.A=[];c=a.C();for(d=0;d<c;)++d,e=new ja,e.qa(a),this.A.push(e);this.Ta=[];c=a.C();for(d=0;d<c;)++d,e=new Aa,e.qa(a),this.Ta.push(e); this.Qb=b();this.Jb=b();this.Ob();if(!this.Rf())throw r.s(new ya("Invalid stadium"));}Rf(){return 0>=this.A.length||0>this.ac||0>this.bc||0>this.Nb.M?!1:!0}Ob(){let a=0,b=this.J;for(;a<b.length;)b[a++].Ob()}hh(){return 255!=this.Gd}Lb(a,b){a=a[b];return null!=a?q.l(a,z):0}sh(a){a=a.canBeStored;return null!=a?q.l(a,db):!0}lh(a){function b(h){let l=q.l(h[0],z);h=q.l(h[1],z);null==h&&(h=0);null==l&&(l=0);return new I(l,h)}function c(h,l,p,t){null==t&&(t=!1);var x=d[l];if(!t||null!=x)if(t=q.l(x,Array), null!=t)for(x=0;x<t.length;){let B=t[x];++x;try{w.ug(B,f),h.push(p(B))}catch(N){throw r.s(new ya('Error in "'+l+'" index: '+h.length));}}}let d=JSON5.parse(a);this.v=[];this.J=[];this.Y=[];this.Sa=[];this.A=[];this.Ta=[];this.pa=q.l(d.name,String);this.cc=q.l(d.width,z);this.Gc=q.l(d.height,z);this.Rd=this.Lb(d,"maxViewWidth")|0;"player"==d.cameraFollow&&(this.Cd=1);this.Ma=200;a=d.spawnDistance;null!=a&&(this.Ma=q.l(a,z));a=d.bg;let e;switch(a.type){case "grass":e=1;break;case "hockey":e=2;break; default:e=0}this.Ec=e;this.Fc=this.Lb(a,"width");this.Dc=this.Lb(a,"height");this.bc=this.Lb(a,"kickOffRadius");this.ac=this.Lb(a,"cornerRadius");this.Cc=7441498;null!=a.color&&(this.Cc=w.Sc(a.color));this.Ad=this.Lb(a,"goalLine");this.Dd=this.sh(d);this.dd="full"==d.kickOffReset;let f=d.traits;a=d.ballPhysics;"disc0"!=a&&(null!=a?(a=w.df(a,this.Uc()),a.m|=192,this.A.push(a)):this.A.push(this.Uc()));c(this.v,"vertexes",w.rh);let g=this;c(this.J,"segments",function(h){return w.qh(h,g.v)});c(this.Sa, "goals",w.mh);c(this.A,"discs",function(h){return w.df(h,new ja)});c(this.Y,"planes",w.oh);c(this.Ta,"joints",function(h){return w.nh(h,g.A)},!0);c(this.Qb,"redSpawnPoints",b,!0);c(this.Jb,"blueSpawnPoints",b,!0);a=d.playerPhysics;null!=a&&(this.Nb=w.ph(a));if(255<this.v.length||255<this.J.length||255<this.Y.length||255<this.Sa.length||255<this.A.length)throw r.s("Error");this.Ob();if(!this.Rf())throw r.s(new ya("Invalid stadium"));}Bg(a,b){let c=0,d=this.Sa;for(;c<d.length;){let h=d[c];++c;var e= h.F,f=h.K,g=b.x-a.x;let l=b.y-a.y;0<-(e.y-a.y)*g+(e.x-a.x)*l==0<-(f.y-a.y)*g+(f.x-a.x)*l?e=!1:(g=f.x-e.x,f=f.y-e.y,e=0<-(a.y-e.y)*g+(a.x-e.x)*f==0<-(b.y-e.y)*g+(b.x-e.x)*f?!1:!0);if(e)return h.rc}return u.na}kb(a,b,c,d,e,f,g,h){null==h&&(h=0);this.pa=a;this.A.push(this.Uc());this.cc=b;this.Gc=c;this.Ec=1;this.Cc=7441498;this.Fc=d;this.Dc=e;this.bc=g;this.ac=h;this.Ma=.75*d;400<this.Ma&&(this.Ma=400);a=new K;var l=a.X;l.x=0;l.y=1;a.ka=-c;a.i=0;this.Y.push(a);a=new K;l=a.X;l.x=0;l.y=-1;a.ka=-c;a.i= 0;this.Y.push(a);a=new K;l=a.X;l.x=1;l.y=0;a.ka=-b;a.i=0;this.Y.push(a);a=new K;l=a.X;l.x=-1;l.y=0;a.ka=-b;a.i=0;this.Y.push(a);this.Vc(d,1,f,13421823,u.ta);this.Vc(-d,-1,f,16764108,u.fa);this.gf(g,c);b=new K;c=b.X;c.x=0;c.y=1;b.ka=-e;b.c=1;this.Y.push(b);b=new K;c=b.X;c.x=0;c.y=-1;b.ka=-e;b.c=1;this.Y.push(b);b=new C;c=b.a;c.x=-d;c.y=-e;b.c=0;c=new C;g=c.a;g.x=d;g.y=-e;c.c=0;g=new C;a=g.a;a.x=d;a.y=-f;g.c=0;a=new C;l=a.a;l.x=d;l.y=f;a.c=0;l=new C;var p=l.a;p.x=d;p.y=e;l.c=0;p=new C;var t=p.a;t.x= -d;t.y=e;p.c=0;t=new C;var x=t.a;x.x=-d;x.y=f;t.c=0;x=new C;var B=x.a;B.x=-d;B.y=-f;x.c=0;f=new G;f.F=c;f.K=g;f.c=1;f.va=!1;B=new G;B.F=a;B.K=l;B.c=1;B.va=!1;let N=new G;N.F=p;N.K=t;N.c=1;N.va=!1;let la=new G;la.F=x;la.K=b;la.c=1;la.va=!1;this.v.push(b);this.v.push(c);this.v.push(g);this.v.push(a);this.v.push(l);this.v.push(p);this.v.push(t);this.v.push(x);this.J.push(f);this.J.push(B);this.J.push(N);this.J.push(la);this.ef(d,e,h);this.Ob()}ff(a,b,c,d,e,f,g,h){this.pa=a;this.A.push(this.Uc());this.cc= b;this.Gc=c;this.Ec=2;this.Fc=d;this.Dc=e;this.bc=75;this.ac=h;this.Ad=g;this.Ma=.75*(d-g);400<this.Ma&&(this.Ma=400);a=new K;var l=a.X;l.x=0;l.y=1;a.ka=-c;a.i=0;this.Y.push(a);a=new K;l=a.X;l.x=0;l.y=-1;a.ka=-c;a.i=0;this.Y.push(a);a=new K;l=a.X;l.x=1;l.y=0;a.ka=-b;a.i=0;this.Y.push(a);a=new K;l=a.X;l.x=-1;l.y=0;a.ka=-b;a.i=0;this.Y.push(a);this.Vc(d-g,1,f,13421823,u.ta,63);this.Vc(-d+g,-1,f,16764108,u.fa,63);this.gf(75,c);b=new K;c=b.X;c.x=0;c.y=1;b.ka=-e;b.c=1;this.Y.push(b);b=new K;c=b.X;c.x= 0;c.y=-1;b.ka=-e;b.c=1;this.Y.push(b);b=new K;c=b.X;c.x=1;c.y=0;b.ka=-d;b.c=1;this.Y.push(b);b=new K;c=b.X;c.x=-1;c.y=0;b.ka=-d;b.c=1;this.Y.push(b);this.ef(d,e,h);this.Ob()}Vc(a,b,c,d,e,f){var g;null==g&&(g=32);null==f&&(f=1);var h=new C,l=h.a;l.x=a+8*b;l.y=-c;l=new C;var p=l.a;p.x=a+8*b;p.y=c;let t=new C;p=t.a;p.x=h.a.x+22*b;p.y=h.a.y+22;let x=new C;p=x.a;p.x=l.a.x+22*b;p.y=l.a.y-22;p=new G;p.F=h;p.K=t;p.bb(90*b);let B=new G;B.F=x;B.K=t;let N=new G;N.F=x;N.K=l;N.bb(90*b);b=this.v.length;this.v.push(h); this.v.push(l);this.v.push(t);this.v.push(x);h=b;for(b=this.v.length;h<b;)l=h++,this.v[l].c=f,this.v[l].m=g,this.v[l].i=.1;b=this.J.length;this.J.push(p);this.J.push(B);this.J.push(N);h=b;for(b=this.J.length;h<b;)l=h++,this.J[l].c=f,this.J[l].m=g,this.J[l].i=.1;f=new ja;g=f.a;g.x=a;g.y=-c;f.L=0;f.M=8;f.T=d;this.A.push(f);f=new ja;g=f.a;g.x=a;g.y=c;f.L=0;f.M=8;f.T=d;this.A.push(f);d=new Fa;f=d.F;f.x=a;f.y=-c;f=d.K;f.x=a;f.y=c;d.rc=e;this.Sa.push(d)}gf(a,b){let c=new C;var d=c.a;d.x=0;d.y=-b;c.i=.1; c.m=24;c.c=6;d=new C;var e=d.a;e.x=0;e.y=-a;d.i=.1;d.m=24;d.c=6;e=new C;var f=e.a;f.x=0;f.y=a;e.i=.1;e.m=24;e.c=6;a=new C;f=a.a;f.x=0;f.y=b;a.i=.1;a.m=24;a.c=6;b=new G;b.F=c;b.K=d;b.m=24;b.c=6;b.va=!1;b.i=.1;f=new G;f.F=e;f.K=a;f.m=24;f.c=6;f.va=!1;f.i=.1;let g=new G;g.F=d;g.K=e;g.m=8;g.c=6;g.va=!1;g.bb(180);g.i=.1;let h=new G;h.F=e;h.K=d;h.m=16;h.c=6;h.va=!1;h.bb(180);h.i=.1;this.v.push(c);this.v.push(d);this.v.push(e);this.v.push(a);this.J.push(b);this.J.push(f);this.J.push(g);this.J.push(h)}ef(a, b,c){if(!(0>=c)){var d=new C,e=d.a;e.x=-a+c;e.y=-b;d.c=0;e=new C;var f=e.a;f.x=-a;f.y=-b+c;e.c=0;f=new C;var g=f.a;g.x=-a+c;g.y=b;f.c=0;g=new C;var h=g.a;h.x=-a;h.y=b-c;g.c=0;h=new C;var l=h.a;l.x=a-c;l.y=b;h.c=0;l=new C;var p=l.a;p.x=a;p.y=b-c;l.c=0;p=new C;var t=p.a;t.x=a-c;t.y=-b;p.c=0;t=new C;var x=t.a;x.x=a;x.y=-b+c;t.c=0;a=new G;a.F=d;a.K=e;a.c=1;a.va=!1;a.i=1;a.bb(-90);b=new G;b.F=f;b.K=g;b.c=1;b.va=!1;b.i=1;b.bb(90);c=new G;c.F=h;c.K=l;c.c=1;c.va=!1;c.i=1;c.bb(-90);x=new G;x.F=p;x.K=t;x.c= 1;x.va=!1;x.i=1;x.bb(90);this.v.push(d);this.v.push(e);this.v.push(f);this.v.push(g);this.v.push(h);this.v.push(l);this.v.push(p);this.v.push(t);this.J.push(a);this.J.push(b);this.J.push(c);this.J.push(x)}}static qa(a){var b=a.C();return 255==b?(b=new w,b.pi(a),b):w.Hd()[b]}static Hd(){if(null==w.wa){w.wa=[];var a=new w;a.kb("Classic",420,200,370,170,64,75);w.wa.push(a);a=new w;a.kb("Easy",420,200,370,170,90,75);w.wa.push(a);a=new w;a.kb("Small",420,200,320,130,55,70);w.wa.push(a);a=new w;a.kb("Big", 600,270,550,240,80,80);w.wa.push(a);a=new w;a.kb("Rounded",420,200,370,170,64,75,75);w.wa.push(a);a=new w;a.ff("Hockey",420,204,398,182,68,120,100);w.wa.push(a);a=new w;a.ff("Big Hockey",600,270,550,240,90,160,150);w.wa.push(a);a=new w;a.kb("Big Easy",600,270,550,240,95,80);w.wa.push(a);a=new w;a.kb("Big Rounded",600,270,550,240,80,75,100);w.wa.push(a);a=new w;a.kb("Huge",750,350,700,320,100,80);w.wa.push(a);a=0;let b=w.wa.length;for(;a<b;){let c=a++;w.wa[c].Gd=c}}return w.wa}static ug(a,b){if(null!= a.trait&&(b=b[q.l(a.trait,String)],null!=b)){let c=0,d=tb.Ai(b);for(;c<d.length;){let e=d[c];++c;null==a[e]&&(a[e]=b[e])}}}static Ua(a){a=q.l(a,Array);let b=0,c=0;for(;c<a.length;)switch(a[c++]){case "all":b|=63;break;case "ball":b|=1;break;case "blue":b|=4;break;case "blueKO":b|=16;break;case "c0":b|=268435456;break;case "c1":b|=536870912;break;case "c2":b|=1073741824;break;case "c3":b|=-2147483648;break;case "kick":b|=64;break;case "red":b|=2;break;case "redKO":b|=8;break;case "score":b|=128;break; case "wall":b|=32}return b}static Sc(a){if("transparent"==a)return-1;if("string"==typeof a)return Wa.parseInt("0x"+Wa.xe(a));if(a instanceof Array)return((a[0]|0)<<16)+((a[1]|0)<<8)+(a[2]|0);throw r.s("Bad color");}static rh(a){let b=new C;b.a.x=q.l(a.x,z);b.a.y=q.l(a.y,z);var c=a.bCoef;null!=c&&(b.i=q.l(c,z));c=a.cMask;null!=c&&(b.c=w.Ua(c));a=a.cGroup;null!=a&&(b.m=w.Ua(a));return b}static qh(a,b){let c=new G;var d=q.l(a.v1,Ea);c.F=b[q.l(a.v0,Ea)];c.K=b[d];b=a.bias;d=a.bCoef;let e=a.curve,f=a.curveF, g=a.vis,h=a.cMask,l=a.cGroup;a=a.color;null!=b&&(c.ub=q.l(b,z));null!=d&&(c.i=q.l(d,z));null!=f?c.Ia=q.l(f,z):null!=e&&c.bb(q.l(e,z));null!=g&&(c.va=q.l(g,db));null!=h&&(c.c=w.Ua(h));null!=l&&(c.m=w.Ua(l));null!=a&&(c.T=w.Sc(a));return c}static nh(a,b){let c=new Aa;var d=q.l(a.d0,Ea),e=q.l(a.d1,Ea);let f=a.color,g=a.strength;a=a.length;if(d>=b.length||0>d)throw r.s(null);if(e>=b.length||0>e)throw r.s(null);c.Ic=d;c.Jc=e;null==a?(d=b[d],e=b[e],null==d||null==e?c.Va=c.La=100:(b=d.a,d=e.a,e=b.x-d.x, b=b.y-d.y,c.Va=c.La=Math.sqrt(e*e+b*b))):a instanceof Array?(c.La=q.l(a[0],z),c.Va=q.l(a[1],z)):c.Va=c.La=q.l(a,z);c.qc=null==g||"rigid"==g?1/0:q.l(g,z);null!=f&&(c.T=w.Sc(f));return c}static oh(a){let b=new K;var c=q.l(a.normal,Array),d=q.l(c[0],z),e=q.l(c[1],z);c=b.X;let f=d;var g=e;null==e&&(g=0);null==d&&(f=0);d=f;e=Math.sqrt(d*d+g*g);c.x=d/e;c.y=g/e;b.ka=q.l(a.dist,z);c=a.bCoef;d=a.cMask;a=a.cGroup;null!=c&&(b.i=q.l(c,z));null!=d&&(b.c=w.Ua(d));null!=a&&(b.m=w.Ua(a));return b}static mh(a){let b= new Fa;var c=q.l(a.p0,Array);let d=q.l(a.p1,Array),e=b.F;e.x=c[0];e.y=c[1];c=b.K;c.x=d[0];c.y=d[1];switch(a.team){case "blue":a=u.ta;break;case "red":a=u.fa;break;default:throw r.s("Bad team value");}b.rc=a;return b}static ph(a){let b=new Ta;var c=a.bCoef,d=a.invMass;let e=a.damping,f=a.acceleration,g=a.kickingAcceleration,h=a.kickingDamping,l=a.kickStrength,p=a.gravity,t=a.cGroup,x=a.radius;a=a.kickback;null!=c&&(b.i=q.l(c,z));null!=d&&(b.L=q.l(d,z));null!=e&&(b.ga=q.l(e,z));null!=f&&(b.zc=q.l(f, z));null!=g&&(b.Oc=q.l(g,z));null!=h&&(b.Pc=q.l(h,z));null!=l&&(b.Mc=q.l(l,z));null!=p&&(c=b.la,d=q.l(p[1],z),c.x=q.l(p[0],z),c.y=d);null!=t&&(b.m=w.Ua(t));null!=x&&(b.M=q.l(x,z));null!=a&&(b.Nc=q.l(a,z));return b}static df(a,b){var c=a.pos,d=a.speed;let e=a.gravity,f=a.radius,g=a.bCoef,h=a.invMass,l=a.damping,p=a.color,t=a.cMask;a=a.cGroup;if(null!=c){let x=b.a;x.x=c[0];x.y=c[1]}null!=d&&(c=b.u,c.x=d[0],c.y=d[1]);null!=e&&(d=b.la,d.x=e[0],d.y=e[1]);null!=f&&(b.M=q.l(f,z));null!=g&&(b.i=q.l(g,z)); null!=h&&(b.L=q.l(h,z));null!=l&&(b.ga=q.l(l,z));null!=p&&(b.T=w.Sc(p));null!=t&&(b.c=w.Ua(t));null!=a&&(b.m=w.Ua(a));return b}}class gb{constructor(a){this.hf=new eb(15);this.Kd=0;this.He=new Map;this.Ug=new Sa(100,16);this.cd=!1;this.$c=0;this.jc=a;a=A.aa(8);a.g(Math.random());this.dc=a.Bb()}ob(a,b){null==b&&(b=0);this.jc.ob(b,a)}}class rb{static Di(){m.$(Z);m.$(Ha);m.$(ua);m.$(Ia);m.$(ma);m.$(ia);m.$(S);m.$(oa);m.$(pa);m.$(qa);m.$(T);m.$(U);m.$(ca);m.$(ra);m.$(ba);m.$(Ja);m.$(Ka);m.$(ha);m.$(La); m.$(na);m.$(fa);m.$(ea);m.$(da);m.$(M)}}class O{constructor(a){O.Ka||this.Aa(a)}Aa(a){this.da=0;this.Ba=a}}class xa{constructor(){this.rf=0;this.c=this.m=63;this.T=16777215;this.ga=.99;this.L=1;this.i=.5;this.M=10;this.la=new I(0,0);this.u=new I(0,0);this.a=new I(0,0)}G(a){var b=this.a;a.g(b.x);a.g(b.y);b=this.u;a.g(b.x);a.g(b.y);b=this.la;a.g(b.x);a.g(b.y);a.g(this.M);a.g(this.i);a.g(this.L);a.g(this.ga);a.xa(this.T);a.w(this.c);a.w(this.m)}Dg(a){var b=this.a,c=a.a,d=b.x-c.x;b=b.y-c.y;var e=a.M+ this.M,f=d*d+b*b;if(0<f&&f<=e*e){f=Math.sqrt(f);d/=f;b/=f;c=this.L/(this.L+a.L);e-=f;f=e*c;var g=this.a,h=this.a;g.x=h.x+d*f;g.y=h.y+b*f;h=g=a.a;e-=f;g.x=h.x-d*e;g.y=h.y-b*e;e=this.u;f=a.u;e=d*(e.x-f.x)+b*(e.y-f.y);0>e&&(e*=this.i*a.i+1,c*=e,g=f=this.u,f.x=g.x-d*c,f.y=g.y-b*c,a=f=a.u,c=e-c,f.x=a.x+d*c,f.y=a.y+b*c)}}Eg(a){if(0!=0*a.Ia){var b=a.F.a;var c=a.K.a;var d=c.x-b.x;var e=c.y-b.y,f=this.a;var g=f.x-c.x;c=f.y-c.y;f=this.a;if(0>=(f.x-b.x)*d+(f.y-b.y)*e||0<=g*d+c*e)return;d=a.X;b=d.x;d=d.y;g=b* g+d*c}else{d=a.ec;g=this.a;b=g.x-d.x;d=g.y-d.y;g=a.jd;c=a.kd;if((0<g.x*b+g.y*d&&0<c.x*b+c.y*d)==0>=a.Ia)return;c=Math.sqrt(b*b+d*d);if(0==c)return;g=c-a.Oe;b/=c;d/=c}c=a.ub;if(0==c)0>g&&(g=-g,b=-b,d=-d);else if(0>c&&(c=-c,g=-g,b=-b,d=-d),g<-c)return;g>=this.M||(g=this.M-g,e=c=this.a,c.x=e.x+b*g,c.y=e.y+d*g,g=this.u,g=b*g.x+d*g.y,0>g&&(g*=this.i*a.i+1,c=a=this.u,a.x=c.x-b*g,a.y=c.y-d*g))}}class m{constructor(){m.Ka||this.Aa()}Aa(){this.fg=this.gg=this.fb=0}eg(){return!0}apply(){throw r.s("missing implementation"); }W(){throw r.s("missing implementation");}S(){throw r.s("missing implementation");}static Z(a){null==a.delay&&(a.delay=!0);null==a.ca&&(a.ca=!0);return a}static $(a){a.lg=m.ke;if(null==a.U)throw r.s("Class doesn't have a config");a.prototype.sd=a.U;m.$f.set(m.ke,a);m.ke++}static ue(a,b){let c=q.Zf(a).lg;if(null==c)throw r.s("Tried to pack unregistered action");b.f(c);a.S(b)}static Ji(a){a=a.C();a=Object.create(m.$f.get(a).prototype);a.fb=0;a.eb=0;return a}}class ub{static mi(a){return new Promise(function(b, c){let d=setTimeout(function(){c("Timed out")},500);a.then(function(e){clearTimeout(d);b(e)},function(e){clearTimeout(d);c(e)})})}}class qb{static Ci(a){let b="";do b="0123456789ABCDEF".charAt(a&15)+b,a>>>=4;while(0<a);for(;2>b.length;)b="0"+b;return b}}class Q{static Xf(a,b){a=a.charCodeAt(b);if(a==a)return a}static substr(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==b)c=a.length+c;else return"";return a.substr(b,c)}static remove(a,b){b=a.indexOf(b);if(-1==b)return!1;a.splice(b, 1);return!0}static now(){return Date.now()}}class ab{constructor(){}zg(){this.pa=R.qb(this.pa,40);this.ib=R.qb(this.ib,3)}G(a){this.zg();a.ra=!0;a.Oa(this.ri);a.Uf(this.pa);a.Uf(this.ib);a.he(this.Rc);a.he(this.Tc);a.f(this.lb?1:0);a.f(this.yh);a.f(this.ba);a.ra=!1}}class G{constructor(){this.jd=this.kd=this.X=null;this.Oe=0;this.K=this.F=this.ec=null;this.ub=0;this.i=1;this.c=63;this.m=32;this.Ia=1/0;this.va=!0;this.T=0}G(a){let b=0,c=a.a;a.f(0);a.f(this.F.Kc);a.f(this.K.Kc);0!=this.ub&&(b=1,a.g(this.ub)); this.Ia!=1/0&&(b|=2,a.g(this.Ia));0!=this.T&&(b|=4,a.w(this.T));this.va&&(b|=8);a.j.setUint8(c,b);a.g(this.i);a.w(this.c);a.w(this.m)}qa(a,b){let c=a.C();this.F=b[a.C()];this.K=b[a.C()];this.ub=0!=(c&1)?a.o():0;this.Ia=0!=(c&2)?a.o():1/0;this.T=0!=(c&4)?a.I():0;this.va=0!=(c&8);this.i=a.o();this.c=a.I();this.m=a.I()}bb(a){a*=.017453292519943295;if(0>a){a=-a;let b=this.F;this.F=this.K;this.K=b;this.ub=-this.ub}a>G.kg&&a<G.jg&&(this.Ia=1/Math.tan(a/2))}Ob(){if(0==0*this.Ia){var a=this.K.a,b=this.F.a, c=.5*(a.x-b.x);a=.5*(a.y-b.y);b=this.F.a;let d=this.Ia;this.ec=new I(b.x+c+-a*d,b.y+a+c*d);a=this.F.a;b=this.ec;c=a.x-b.x;a=a.y-b.y;this.Oe=Math.sqrt(c*c+a*a);c=this.F.a;a=this.ec;this.jd=new I(-(c.y-a.y),c.x-a.x);c=this.ec;a=this.K.a;this.kd=new I(-(c.y-a.y),c.x-a.x);0>=this.Ia&&(a=c=this.jd,c.x=-a.x,c.y=-a.y,a=c=this.kd,c.x=-a.x,c.y=-a.y)}else a=this.F.a,b=this.K.a,c=a.x-b.x,a=-(a.y-b.y),b=Math.sqrt(a*a+c*c),this.X=new I(a/b,c/b)}}class ta extends pako.Inflate{constructor(a){super({raw:!0});this.buffer= a;this.total=0}onData(a){let b=this.total+a.byteLength;if(b>this.buffer.length)throw Error("Inflate size exceeds limit");this.buffer.set(a,this.total);this.total=b}onEnd(a){this.err=a}static Wf(a,b){let c=new ta(b);c.push(a,!0);if(0!=c.err)throw Error("Inflate error");return b.subarray(0,c.total)}}class ua extends m{constructor(){super()}apply(a){a.Fg(this.qd)}S(a){a.Ea(this.qd.byteLength);a.Sf(this.qd)}W(a){this.qd=a.Oh(a.nb())}}class Ma extends O{constructor(a){O.Ka?super():(O.Ka=!0,super(),O.Ka= !1,this.Aa(a))}Aa(a){this.nd=this.Ra=0;this.Zd=new Ya;this.Lg=0;this.Ae=.06;super.Aa(a)}sg(a){let b=this.Zd.list,c=0,d=b.length,e=0;for(;e<a;){for(++e;c<d;){let f=b[c];if(f.eb!=this.da)break;f.apply(this.Ba);null!=this.yb&&this.yb(f);this.Ra++;++c}this.Ba.Ca(1);this.nd+=this.Ra;this.Ra=0;this.da++}for(;c<d;){a=b[c];if(a.eb!=this.da||a.fb!=this.Ra)break;a.apply(this.Ba);null!=this.yb&&this.yb(a);this.Ra++;++c}b.splice(0,c)}Bf(a){a.eb==this.da&&a.fb<=this.Ra?(a.fb=this.Ra++,a.apply(this.Ba),null!=this.yb&& this.yb(a)):this.Zd.Ei(a)}}class Ua extends Ma{constructor(a){O.Ka=!0;super();O.Ka=!1;this.Aa(a)}Aa(a){this.Bc=new Map;this.lb=null;this.Wc=32;this.wb=new Map;this.Ha=[];this.Rb=2;this.Cg=600;super.Aa(a.state);this.wh=a.Fi;this.ti=a.version;this.xh=1;this.bf=0;this.Kf=performance.now();this.Wa=new Ga(this.wh,a.iceServers,kb.channels,a.Ii);this.Wa.Ne=ib(this,this.Yg);let b=this;this.Wa.lf=function(c){b.Bh(c)};this.Wa.Yc=function(c){Pa.sa(b.Yc,c)};this.Wa.ic=function(c,d){null!=b.ic&&b.ic(c, d)}}Ng(a,b,c,d){let e=this.wb.get(a);if(null!=e){if(d){let f=this.Wa.wg(e.jc);this.Bc.set(a,f)}a=A.aa();a.f(5);a.f(d?1:0);a.Ub(b);null==c&&(c="");a.Ub(c);e.ob(a);e.jc.cb()}}Fd(){this.Wa.Fd();this.Bc.clear()}Ed(a){let b=this.Bc.get(a);null!=b&&this.Wa.Ed(b);this.Bc.delete(a)}ce(a){this.Wa.ce(a)}be(a){this.Wa.be(a)}nc(a){a.B=0;let b=this.da+this.Rb+this.Lg;a.sd.delay||(b=this.da);a.eb=b;this.Bf(a);this.ae();0<this.Ha.length&&this.hd(this.Pd(a),1)}Df(a,b){b=this.wb.get(b);if(null!=b){a.B=0;var c=A.aa(); c.f(6);m.ue(a,c);b.ob(c,0)}}Ca(){let a=((performance.now()-this.Kf)*this.Ae|0)-this.da;0<a&&this.sg(a);7<=this.da-this.cf&&this.ae();this.da-this.bf>=this.Cg&&(this.ae(),this.Xh())}Yg(a,b){if(this.Ha.length>=this.Wc)return va.yc(4100);try{if(b.kc()!=this.ti)throw r.s(null);}catch(c){return va.yc(4103)}try{let c=b.Ya();if(null!=this.lb&&c!=this.lb)throw r.s(null);}catch(c){return va.yc(4101)}return va.ze}Bh(a){if(this.Ha.length>=this.Wc)a.cb();else{var b=new gb(a);this.Ha.push(b);var c=this; a.nf=function(d){c.Kh(d,b)};a.mf=function(){Q.remove(c.Ha,b);c.wb.delete(b.P);Pa.sa(c.Ah,b.P)};a=A.aa(1+b.dc.byteLength);a.f(0);a.Ea(b.dc.byteLength);a.pb(b.dc);b.ob(a)}}Pd(a){let b=A.aa();b.f(2);this.qf(a,b);return b}qf(a,b){b.xa(a.eb);b.Ea(a.fb);b.Oa(a.B);b.xa(a.wi);m.ue(a,b)}ae(){if(!(0>=this.da-this.cf)&&0!=this.Ha.length){var a=A.aa();a.f(3);a.xa(this.da);a.xa(this.nd);this.hd(a,2);this.cf=this.da}}hd(a,b){null==b&&(b=0);let c=0,d=this.Ha;for(;c<d.length;){let e=d[c];++c;e.cd&&e.ob(a,b)}}ai(a){let b= A.aa();b.f(1);let c=A.aa();c.Oa(a.P);c.xa(this.da);c.xa(this.nd);c.Ea(this.Ra);this.Ba.G(c);let d=this.Zd.list,e=0,f=d.length;for(;e<f;)this.qf(d[e++],c);b.pb(pako.deflateRaw(c.Bb()));a.ob(b)}Xh(){this.bf=this.da;if(0!=this.Ha.length){var a=new ua;a.eb=this.da;a.fb=this.Ra++;a.B=0;a.qd=this.Ba.Rg();this.hd(this.Pd(a))}}Mh(a,b){let c=a.Ga(a.nb()),d=a.Ga(a.nb());a=b.dc;b.dc=null;let e=this;ka.si(c,a).catch(function(){return null}).then(function(f){try{if(-1!=e.Ha.indexOf(b)){b.Jg=f;var g=e.xh++;b.P= g;e.wb.set(g,b);Ra.sa(e.zh,g,new L(new DataView(d.buffer,d.byteOffset,d.byteLength),!1));b.cd=!0;e.ai(b)}}catch(h){f=r.Vb(h).Ib(),e.We(b,f)}})}Kh(a,b){this.Ca();try{let c=new L(new DataView(a));if(!b.Ug.Qf())throw r.s(1);let d=c.C();if(b.cd)switch(d){case 1:this.Nh(c,b);break;case 2:this.Lh(c,b);break;default:throw r.s(0);}else if(0==d)this.Mh(c,b);else throw r.s(0);if(0<c.j.byteLength-c.a)throw r.s(2);}catch(c){this.We(b,r.Vb(c).Ib())}}We(a,b){wa.console.log(b);this.wb.delete(a.P);Q.remove(this.Ha, a);a.cd&&null!=this.kf&&this.kf(a.P);a.jc.cb()}Lh(a,b){let c=a.o();b.$c=a.nb();a=A.aa();a.f(4);a.g((performance.now()-this.Kf)*this.Ae+this.Rb);a.g(c);b.ob(a,2)}Nh(a,b){var c=a.Pb();let d=a.Pb(),e=m.Ji(a);var f=e.sd.ud;if(null!=f){var g=b.He.get(f);null==g&&(g=new Sa(f.pd,f.xd),b.He.set(f,g));if(!g.Qf())throw r.s(3);}f=e.sd.Gi;if(null==f||f(b.P,this.Ba)){e.W(a);a=this.da+this.Rb;f=this.da;g=this.da+20;f=c<f?f:c>g?g:c;g=c-a;if(e.sd.delay){if(g<-this.Rb-3)f=a;else{let h=-this.Rb,l=this.Rb;b.hf.rg(g< h?h:g>l?l:g)}f<a&&-.85>b.hf.vg()&&(f=a);f<b.Kd&&(f=b.Kd);b.Kd=f}e.fg=g;c=f-c;e.gg=0<c?c:0;e.wi=d;e.B=b.P;e.eb=f;e.eg(this.Ba)&&(this.Bf(e),this.hd(this.Pd(e),1))}else a.Ga()}}class Ka extends m{constructor(){super()}apply(a){let b=a.O(this.B);null!=b&&this.re!=b.ne&&(b.ne=this.re,Pa.sa(a.Mi,b))}S(a){a.f(this.re?1:0)}W(a){this.re=0!=a.C()}}class Z extends m{constructor(){super()}apply(a){0==this.B&&Xa.sa(a.Oi,this.Pa,this.color,this.style,this.we)}S(a){a.Ub(R.qb(this.Pa,1E3));a.w(this.color);a.f(this.style); a.f(this.we)}W(a){this.Pa=a.mb();if(1E3<this.Pa.length)throw r.s("message too long");this.color=a.I();this.style=a.C();this.we=a.C()}static V(a,b,c,d){let e=new Z;e.Pa=a;e.color=b;e.style=c;e.we=d;return e}}class Ja extends m{constructor(){super()}apply(a){if(a.za(this.B)){for(var b=a.O(this.B),c=a.ba,d=[],e=0,f=0,g=0;g<c.length;){let h=c[g];++g;h.ja==u.na&&d.push(h);h.ja==u.fa?++e:h.ja==u.ta&&++f}c=d.length;0!=c&&(f==e?2>c||(a.Hc(b,d[0],u.fa),a.Hc(b,d[1],u.ta)):a.Hc(b,d[0],f>e?u.fa:u.ta))}}S(){}W(){}} class T extends m{constructor(){super()}apply(a){if(a.za(this.B)&&null==a.D)switch(this.ve){case 0:var b=this.newValue;a.ab=0>b?0:99<b?99:b;break;case 1:b=this.newValue,a.Na=0>b?0:99<b?99:b}}S(a){a.w(this.ve);a.w(this.newValue)}W(a){this.ve=a.I();this.newValue=a.I()}static V(a,b){let c=new T;c.ve=a;c.newValue=b;return c}}class ba extends m{constructor(){super()}apply(a){if(a.za(this.B)){var b=a.O(this.B),c=a.O(this.Gb);null!=c&&0!=c.ma&&c.Cb!=this.td&&(c.Cb=this.td,null!=a.sf&&a.sf(b,c))}}S(a){a.w(this.Gb); a.f(this.td?1:0)}W(a){this.Gb=a.I();this.td=0!=a.C()}static V(a,b){let c=new ba;c.Gb=a;c.td=b;return c}}class La extends m{constructor(){super()}apply(a){a=a.O(this.B);null!=a&&(a.Eb=this.Fa)}S(a){a.Da(this.Fa)}W(a){this.Fa=a.Ya();null!=this.Fa&&(this.Fa=R.qb(this.Fa,2))}}class ca extends m{constructor(){super()}apply(a){let b=a.O(this.Gb);if(null!=b){var c=a.O(this.B),d=a.za(this.B);(d=d||b==c&&!a.md&&null==a.D)&&a.Hc(c,b,this.se)}}S(a){a.w(this.Gb);a.f(this.se.P)}W(a){this.Gb=a.I();a=a.Wd();this.se= 1==a?u.fa:2==a?u.ta:u.na}static V(a,b){let c=new ca;c.Gb=a;c.se=b;return c}}class U extends m{constructor(){super()}apply(a){if(a.za(this.B)){var b=a.O(this.B);null==a.D&&(a.ea=this.wd,null!=a.Hf&&a.Hf(b,this.wd))}}S(a){var b=A.aa();this.wd.G(b);b=pako.deflateRaw(b.Bb());a.Oa(b.byteLength);a.pb(b)}W(a){a=pako.inflateRaw(a.Ga(a.kc()));this.wd=w.qa(new L(new DataView(a.buffer,a.byteOffset,a.byteLength),!1))}static V(a){let b=new U;b.wd=a;return b}}class na extends m{constructor(){super()}apply(a){a.za(this.B)&& this.ja!=u.na&&(a.sc[this.ja.P]=this.rd)}S(a){a.f(this.ja.P);this.rd.G(a)}W(a){let b=a.Wd();this.ja=1==b?u.fa:2==b?u.ta:u.na;this.rd=new W;this.rd.qa(a)}}class ra extends m{constructor(){super()}apply(a){if(a.za(this.B)){var b=a.md;a.md=this.newValue;b!=this.newValue&&Ra.sa(a.ji,a.O(this.B),this.newValue)}}S(a){a.f(this.newValue?1:0)}W(a){this.newValue=0!=a.C()}}class ia extends m{constructor(){super()}apply(a){if(0==this.B){var b=new Ba;b.ma=this.ma;b.pa=this.name;b.country=this.me;b.Eb=this.Eb; a.ba.push(b);a=a.Fh;null!=a&&a(b)}}S(a){a.w(this.ma);a.Da(this.name);a.Da(this.me);a.Da(this.Eb)}W(a){this.ma=a.I();this.name=a.Ya();this.me=a.Ya();this.Eb=a.Ya()}static V(a,b,c,d){let e=new ia;e.ma=a;e.name=b;e.me=c;e.Eb=d;return e}}class da extends m{constructor(){super()}apply(a){a=a.O(this.sb);null!=a&&0==this.B&&(a.Vf=this.Fa)}S(a){a.Da(this.Fa);a.w(this.sb)}W(a){this.Fa=a.Ya();this.sb=a.I();null!=this.Fa&&(this.Fa=R.qb(this.Fa,2))}static V(a,b){let c=new da;c.Fa=null!=b?R.qb(b,2):null;c.sb= a;return c}}class qa extends m{constructor(){super()}apply(a){let b=a.D;if(null!=b&&a.za(this.B)){var c=a.O(this.B),d=120==b.Xa,e=0<b.Xa;this.wc?b.Xa=120:120==b.Xa&&(b.Xa=119);d!=this.wc&&jb.sa(a.Dh,c,this.wc,e)}}S(a){a.f(this.wc?1:0)}W(a){this.wc=0!=a.C()}}class ma extends m{constructor(){super()}eg(a){if(null!=a.tf){let b=a.O(this.B);return null==b?!1:a.tf(b,this.Pa)}return!0}apply(a){let b=a.O(this.B);null!=b&&Ra.sa(a.Li,b,this.Pa)}S(a){a.Ub(R.qb(this.Pa,140))}W(a){this.Pa=a.mb();if(140<this.Pa.length)throw r.s("message too long"); }}class Ia extends m{constructor(){super()}apply(a){let b=a.O(this.B);if(null!=b){var c=this.input;0==(b.Kb&16)&&0!=(c&16)&&(b.Db=!0);b.Kb=c;null!=a.uf&&null!=b.N&&a.uf(b,this.input,this.fg,this.gg)}}S(a){a.xa(this.input)}W(a){this.input=a.Pb()}}class Ha extends m{constructor(){super()}apply(a){let b=a.O(this.B);null!=b&&Ra.sa(a.Ni,b,this.hg)}S(a){a.f(this.hg)}W(a){this.hg=a.C()}}class S extends m{constructor(){m.Ka=!0;super();m.Ka=!1;this.Aa()}Aa(){this.od=!1;super.Aa()}apply(a){if(0!=this.ma&&a.za(this.B)){var b= a.O(this.ma);if(null!=b){var c=a.O(this.B);Q.remove(a.ba,b);null!=a.D&&Q.remove(a.D.ia.A,b.N);Xa.sa(a.Gh,b,this.rb,this.od,c)}}}S(a){null!=this.rb&&(this.rb=R.qb(this.rb,100));a.w(this.ma);a.Da(this.rb);a.f(this.od?1:0)}W(a){this.ma=a.I();this.rb=a.Ya();this.od=0!=a.C();if(null!=this.rb&&100<this.rb.length)throw r.s("string too long");}static V(a,b,c){let d=new S;d.ma=a;d.rb=b;d.od=c;return d}}class fa extends m{constructor(){super()}apply(a){if(0==this.B){for(var b=new Map,c=0,d=a.ba;c<d.length;){var e= d[c];++c;b.set(e.ma,e)}c=[];d=0;for(e=this.vc;d<e.length;){var f=e[d];++d;let g=b.get(f);null!=g&&(b.delete(f),c.push(g))}d=[];b=b.values();for(e=b.next();!e.done;)f=e.value,e=b.next(),d.push(f);a.ba=this.te?c.concat(d):d.concat(c)}}S(a){a.f(this.te?1:0);a.f(this.vc.length);let b=0,c=this.vc;for(;b<c.length;)a.w(c[b++])}W(a){this.te=0!=a.C();let b=a.C();this.vc=[];let c=0;for(;c<b;)++c,this.vc.push(a.I())}static V(a,b){let c=new fa;for(var d=new Set,e=0;e<a.length;)d.add(a[e++]);a=[];e=0;d=d.values(); let f=d.next();for(;!f.done;){let g=f.value;f=d.next();a.push(g);++e;if(40<=e)break}c.vc=a;c.te=b;return c}}class M extends m{constructor(){super()}apply(a){if(0==this.B){var b=a.D;if(null!=b){if(this.pe){a=a.O(this.sb);if(null==a)return;a=a.N}else a=b.ia.A[this.sb];null!=a&&(null!=this.R[0]&&(a.a.x=this.R[0]),null!=this.R[1]&&(a.a.y=this.R[1]),null!=this.R[2]&&(a.u.x=this.R[2]),null!=this.R[3]&&(a.u.y=this.R[3]),null!=this.R[4]&&(a.la.x=this.R[4]),null!=this.R[5]&&(a.la.y=this.R[5]),null!=this.R[6]&& (a.M=this.R[6]),null!=this.R[7]&&(a.i=this.R[7]),null!=this.R[8]&&(a.L=this.R[8]),null!=this.R[9]&&(a.ga=this.R[9]),null!=this.ya[0]&&(a.T=this.ya[0]),null!=this.ya[1]&&(a.c=this.ya[1]),null!=this.ya[2]&&(a.m=this.ya[2]))}}}S(a){a.w(this.sb);a.f(this.pe?1:0);let b=a.a;a.Oa(0);let c=0;for(var d=1,e=0,f=this.R;e<f.length;){var g=f[e];++e;null!=g&&(c|=d,a.he(g));d<<=1}e=0;for(f=this.ya;e<f.length;)g=f[e],++e,null!=g&&(c|=d,a.w(g)),d<<=1;d=a.a;a.a=b;a.Oa(c);a.a=d}W(a){this.sb=a.I();this.pe=0!=a.C();let b= a.kc();this.R=[];for(var c=0;10>c;){var d=c++;this.R[d]=null;0!=(b&1)&&(this.R[d]=a.Ph());b>>>=1}this.ya=[];for(c=0;3>c;)d=c++,this.ya[d]=null,0!=(b&1)&&(this.ya[d]=a.I()),b>>>=1}static cg(a,b,c){let d=new M;d.sb=a;d.pe=b;d.R=[c.x,c.y,c.xspeed,c.yspeed,c.xgravity,c.ygravity,c.radius,c.bCoeff,c.invMass,c.damping];d.ya=[c.color,c.cMask,c.cGroup];a=0;for(b=d.R.length;a<b;){c=a++;var e=d.R[c];null!=e&&(M.Yf[0]=e,d.R[c]=M.Yf[0])}a=0;for(b=d.ya.length;a<b;)c=a++,e=d.ya[c],null!=e&&(M.ag[0]=e,d.ya[c]=M.ag[0]); return d}}class ea extends m{constructor(){super()}apply(a){a.za(this.B)&&a.bi(a.O(this.B),this.min,this.rate,this.le)}S(a){a.w(this.min);a.w(this.rate);a.w(this.le)}W(a){this.min=a.I();this.rate=a.I();this.le=a.I()}static V(a,b,c){let d=new ea;d.min=a;d.rate=b;d.le=c;return d}}class oa extends m{constructor(){super()}apply(a){a.za(this.B)&&a.fi(a.O(this.B))}S(){}W(){}}class pa extends m{constructor(){super()}apply(a){if(a.za(this.B)){var b=a.O(this.B);if(null!=a.D){a.D=null;let c=0,d=a.ba;for(;c< d.length;){let e=d[c];++c;e.N=null;e.Fb=0}null!=a.ld&&a.ld(b)}}}S(){}W(){}}class ha extends m{constructor(){super()}apply(a){if(0==this.B){a=a.ba;for(var b=0,c=a.length;b<c;){let d=b++;if(d>=this.Xb.length)break;a[d].$c=this.Xb[d]}}}S(a){a.Ea(this.Xb.length);let b=0,c=this.Xb;for(;b<c.length;)a.Ea(c[b++])}W(a){this.Xb=[];let b=a.nb(),c=0;for(;c<b;)++c,this.Xb.push(a.nb())}static V(a){let b=new ha,c=a.Ba.ba,d=[],e=0;for(;e<c.length;){let f=a.wb.get(c[e++].ma);d.push(null==f?0:f.$c)}b.Xb=d;return b}} class r extends Error{constructor(a,b,c){super(a);this.message=a;this.Fe=null!=c?c:this}Ib(){return this.Fe}toString(){return this.message}static Vb(a){return a instanceof r?a:a instanceof Error?new r(a.message,null,a):new Na(a,null,a)}static s(a){return a instanceof r?a.Fe:a instanceof Error?a:new Na(a)}}class Na extends r{constructor(a,b,c){super(String(a),b,c);this.value=a}Ib(){return this.value}}var fb=fb||{},hb;Q.b=!0;Math.b=!0;tb.b=!0;Wa.b=!0;qb.b=!0;R.b=!0;lb.b=!0;lb.zd=!0;sa.b=!0;sa.gb=[lb]; Object.assign(sa.prototype,{h:sa});var va=fb["bas.basnet.ConnectionRequestResponse"]={Ce:!0,Be:null,ze:{Xe:"Accept",Ld:0,Yb:"bas.basnet.ConnectionRequestResponse",toString:pb},yc:(hb=function(a){return{Ld:1,reason:a,Yb:"bas.basnet.ConnectionRequestResponse",toString:pb}},hb.Xe="Reject",hb.Ge=["reason"],hb)};va.Be=[va.ze,va.yc];Ga.b=!0;Object.assign(Ga.prototype,{h:Ga});vb.b=!0;Za.b=!0;Object.assign(Za.prototype,{h:Za});L.b=!0;Object.assign(L.prototype,{h:L});A.b=!0;Object.assign(A.prototype,{h:A}); ka.b=!0;za.b=!0;ta.b=!0;ta.H=pako.Inflate;Object.assign(ta.prototype,{h:ta});ub.b=!0;m.b=!0;Object.assign(m.prototype,{h:m});Ya.b=!0;Object.assign(Ya.prototype,{h:Ya});O.b=!0;Object.assign(O.prototype,{h:O});ua.b=!0;ua.H=m;Object.assign(ua.prototype,{h:ua});Va.b=!0;Va.zd=!0;Object.assign(Va.prototype,{h:Va});$a.b=!0;Object.assign($a.prototype,{h:$a});X.b=!0;X.zd=!0;Ma.b=!0;Ma.H=O;Object.assign(Ma.prototype,{h:Ma});Ua.b=!0;Ua.H=Ma;Object.assign(Ua.prototype,{h:Ua});gb.b=!0;Object.assign(gb.prototype, {h:gb});eb.b=!0;Object.assign(eb.prototype,{h:eb});kb.b=!0;nb.b=!0;Object.assign(nb.prototype,{h:nb});I.b=!0;Object.assign(I.prototype,{h:I});V.b=!0;Pa.b=!0;Ra.b=!0;jb.b=!0;Xa.b=!0;Sa.b=!0;Object.assign(Sa.prototype,{h:Sa});Y.b=!0;Object.assign(Y.prototype,{h:Y});Ca.b=!0;E.b=!0;ab.b=!0;Object.assign(ab.prototype,{h:ab});ja.b=!0;Object.assign(ja.prototype,{h:ja});P.b=!0;P.gb=[X];Object.assign(P.prototype,{h:P});Fa.b=!0;Object.assign(Fa.prototype,{h:Fa});Ta.b=!0;Object.assign(Ta.prototype,{h:Ta});ya.b= !0;Object.assign(ya.prototype,{h:ya});w.b=!0;Object.assign(w.prototype,{h:w});W.b=!0;Object.assign(W.prototype,{h:W});u.b=!0;Object.assign(u.prototype,{h:u});Qa.b=!0;Qa.gb=[X,Va];Object.assign(Qa.prototype,{h:Qa});Ba.b=!0;Ba.gb=[X];Object.assign(Ba.prototype,{h:Ba});Ka.b=!0;Ka.H=m;Object.assign(Ka.prototype,{h:Ka});Z.b=!0;Z.H=m;Object.assign(Z.prototype,{h:Z});Ja.b=!0;Ja.H=m;Object.assign(Ja.prototype,{h:Ja});T.b=!0;T.H=m;Object.assign(T.prototype,{h:T});ba.b=!0;ba.H=m;Object.assign(ba.prototype, {h:ba});La.b=!0;La.H=m;Object.assign(La.prototype,{h:La});ca.b=!0;ca.H=m;Object.assign(ca.prototype,{h:ca});U.b=!0;U.H=m;Object.assign(U.prototype,{h:U});na.b=!0;na.H=m;Object.assign(na.prototype,{h:na});ra.b=!0;ra.H=m;Object.assign(ra.prototype,{h:ra});ia.b=!0;ia.H=m;Object.assign(ia.prototype,{h:ia});da.b=!0;da.H=m;Object.assign(da.prototype,{h:da});qa.b=!0;qa.H=m;Object.assign(qa.prototype,{h:qa});ma.b=!0;ma.H=m;Object.assign(ma.prototype,{h:ma});Ia.b=!0;Ia.H=m;Object.assign(Ia.prototype,{h:Ia}); Ha.b=!0;Ha.H=m;Object.assign(Ha.prototype,{h:Ha});rb.b=!0;S.b=!0;S.H=m;Object.assign(S.prototype,{h:S});fa.b=!0;fa.H=m;Object.assign(fa.prototype,{h:fa});M.b=!0;M.H=m;Object.assign(M.prototype,{h:M});ea.b=!0;ea.H=m;Object.assign(ea.prototype,{h:ea});oa.b=!0;oa.H=m;Object.assign(oa.prototype,{h:oa});pa.b=!0;pa.H=m;Object.assign(pa.prototype,{h:pa});ha.b=!0;ha.H=m;Object.assign(ha.prototype,{h:ha});xa.b=!0;xa.gb=[X];Object.assign(xa.prototype,{h:xa});Aa.b=!0;Aa.gb=[X];Object.assign(Aa.prototype,{h:Aa}); Oa.b=!0;Oa.gb=[X];Object.assign(Oa.prototype,{h:Oa});K.b=!0;Object.assign(K.prototype,{h:K});G.b=!0;Object.assign(G.prototype,{h:G});C.b=!0;Object.assign(C.prototype,{h:C});r.b=!0;r.H=Error;Object.assign(r.prototype,{h:r});Na.b=!0;Na.H=r;Object.assign(Na.prototype,{h:Na});mb.b=!0;Object.assign(mb.prototype,{h:mb});q.b=!0;wa.ye|=0;"undefined"!=typeof performance&&"function"==typeof performance.now&&(Q.now=performance.now.bind(performance));null==String.fromCodePoint&&(String.fromCodePoint=function(a){return 65536> a?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&1023)+56320)});Object.defineProperty(String.prototype,"__class__",{value:String,enumerable:!1,writable:!0});String.b=!0;Array.b=!0;var Ea={},xb={},z=Number,db=Boolean,yb={},zb={};u.na=new u(0,16777215,0,-1,"Spectators","t-spec",0,0);u.fa=new u(1,15035990,-1,8,"Red","t-red",15035990,2);u.ta=new u(2,5671397,1,16,"Blue","t-blue",625603,4);u.na.Zc=u.na;u.fa.Zc=u.ta;u.ta.Zc=u.fa;q.qg={}.toString;sa.Gg={mandatory:{OfferToReceiveAudio:!1, OfferToReceiveVideo:!1}};var wb=new Uint8Array(51200);ka.tg={name:"ECDSA",namedCurve:"P-256"};ka.di={name:"ECDSA",hash:{name:"SHA-256"}};m.Ka=!1;m.$f=new Map;m.ke=0;O.Ka=!1;ua.U=m.Z({ca:!1,delay:!1});kb.channels=[{name:"ro",reliable:!0,ordered:!0},{name:"ru",reliable:!0,ordered:!1},{name:"uu",reliable:!1,ordered:!1}];V.ig="application/x-www-form-urlencoded";Ca.Ke="https://www.haxball.com/rs/";Ca.Nd=[{urls:"stun:stun.l.google.com:19302"}];E.Se=new Y;E.Ff=!1;P.jf=function(){let a=[];{let b=0;for(;256> b;)++b,a.push(new I(0,0))}return a}(this);P.Re=function(){let a=[];{let b=0;for(;256>b;)++b,a.push(0)}return a}(this);Ka.U=m.Z({ca:!1,delay:!1,ud:{pd:2,xd:1E4}});Z.U=m.Z({ca:!1,delay:!1,ud:{pd:10,xd:900}});Ja.U=m.Z({ca:!1,delay:!1});T.U=m.Z({ca:!1,delay:!1});ba.U=m.Z({ca:!1,delay:!1});La.U=m.Z({ca:!1,delay:!1});ca.U=m.Z({ca:!1,delay:!1});U.U=m.Z({ca:!1,delay:!1,ud:{pd:10,xd:2E3},Gi:function(a,b){a=b.O(a);return null!=a?a.Cb:!1}});na.U=m.Z({ca:!1,delay:!1});ra.U=m.Z({ca:!1,delay:!1});ia.U=m.Z({ca:!1, delay:!1});da.U=m.Z({ca:!1,delay:!1});qa.U=m.Z({});ma.U=m.Z({ca:!1,delay:!1,ud:{pd:10,xd:900}});Ia.U=m.Z({});Ha.U=m.Z({ca:!1,delay:!1});S.U=m.Z({ca:!1,delay:!1});fa.U=m.Z({ca:!1,delay:!1});M.U=m.Z({ca:!1,delay:!1});M.Yf=new Float32Array(1);M.ag=new Int32Array(1);ea.U=m.Z({ca:!1,delay:!1});oa.U=m.Z({ca:!1,delay:!1});pa.U=m.Z({ca:!1,delay:!1});ha.U=m.Z({ca:!1,delay:!1});G.kg=.17435839227423353;G.jg=5.934119456780721;E.th()})("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!= typeof self?self:this);